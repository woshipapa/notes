# 事务

1. **活动状态（Active）**:
   - 这是事务的初始状态。
   - 在这个状态下，事务正在执行。
   - 事务的操作（如数据库修改）正在进行中。
2. **部分提交状态（Partially Committed）**:
   - 事务到达这个状态时，它的最终操作（或语句）已经被执行了，但还没有完全提交。
   - 在这个阶段，事务已经执行了所有的命令，但还没有完成提交过程。例如，它可能正在等待系统确认所有数据都已经成功写入存储。
3. **失败状态（Failed）**:
   - 如果在执行过程中遇到问题（如违反完整性约束、系统错误等），事务将进入失败状态。
   - 此时，正常执行无法继续进行。
   - 事务需要被回滚（即撤销至开始状态前的状态）。
4. **中止状态（Aborted）**:
   - 一旦事务失败，并且系统已将数据库恢复到事务开始前的状态，事务就会进入中止状态。
   - 进入这个状态后，有两个选项：
     - 重新启动事务：如果事务失败是由于临时问题（如死锁），而非内部逻辑错误，事务可以被重新启动。
     - 终止事务：如果失败是由于逻辑错误或其他无法解决的问题，事务将被终止。
5. **提交状态（Committed）**:
   - 当事务成功完成，并且所有的更改都已永久保存到数据库中时，事务达到提交状态。
   - 一旦事务提交，它所做的更改就成为数据库的一部分，不能被回滚。

![image-20240112225010908](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240112225010908.png)



# ACID

![image-20240112225529501](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240112225529501.png)

## 冲突可串行化

![image-20240112232545390](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240112232545390.png)

# 2-phase锁

俩个阶段，一个增长阶段尽可能多的膨胀，获取锁，收缩阶段释放所有的锁，并且不能再次立刻获得锁

![image-20240113001335049](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113001335049.png)

大题改写成俩段锁，要注意题中给的是XLock和Unlock以及有没有S锁，并且一般每个事务的首次请求时刻都要去获取一下锁，每一时刻只能有一个事务在执行，不能并行。

