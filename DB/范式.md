# 范式判断

非主属性是没有在候选码中出现的属性，是可以拆开看的，包括候选码是整体的那种

BCNF是看函数依赖集中的所有函数依赖左部都必须是候选码，这里不能拆看就是完整的

## 2NF

非主属性要完全依赖于候选码，而不是一部分！！1

![image-20240113152341484](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113152341484.png)

可以减少数据冗余，因为如果不满足2nf，就说明有的非主属性依赖于候选码的一部分，完全可以分出一张表，是这个候选码的一部分作为新的表的候选码，从而减少冗余

![image-20240113152714642](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113152714642.png)

冗余的例子，就是不符合2nf的

而且存在更新异常，因为这些冗余的数据，必须全部更新，否则就会数据不一致

![image-20240113152912677](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113152912677.png)

### 缺陷

存在非主属性对候选码的传递依赖，而**不是直接依赖**

### 关系模式和函数依赖

- **关系模式**：`emp (emp_id, emp_name, emp_phone, dept_name, dept_phone, dept_mgrname)`
- **函数依赖**：`F = {emp_id → (emp_name, emp_phone, dept_name), dept_name → (dept_phone, dept_mgrname)}`

### 满足2NF

这个关系模式满足2NF，因为每个非主属性都完全依赖于候选键（这里假设 `emp_id` 是候选键），并没有部分依赖（即没有属性只依赖于候选键的一部分）。

### 存在的问题

尽管关系模式满足2NF，但它依然存在插入异常、删除异常、更新异常和数据冗余的问题：

1. **插入异常（Insert Anomaly）**：如果我们想要添加一个新部门，但还没有任何员工分配到这个部门，我们无法仅插入部门信息（`dept_name, dept_phone, dept_mgrname`），因为这些信息依赖于员工ID（`emp_id`）。
2. **删除异常（Delete Anomaly）**：如果一个部门的最后一个员工离职（删除记录），那么关于该部门的所有信息（如部门电话和部门经理名称）也将从数据库中消失。
3. **更新异常（Update Anomaly）**：如果需要更改某个部门的电话号码或部门经理，我们必须在所有该部门员工的记录中进行更新。这不仅效率低下，还可能导致数据不一致，如果某些记录未被正确更新。
4. **数据冗余**：由于每个员工记录都包含部门信息（即使这些信息对于同一部门的所有员工都是相同的），这导致了不必要的数据重复。

# 3NF

非主属性branch_city传递的依赖于候选键loan_number

![image-20240113155602036](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113155602036.png)

将传递的那部分函数依赖拆下来作为一个新的表

![image-20240113155904004](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113155904004.png)

没有非主属性，铁定3NF起步

插入异常，当我想插入一个全新的那个多余的（应该被拎出来单独为一张表的关系），会插入异常，因为前面的信息还没有

![image-20240113160513902](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113160513902.png)

![image-20240113160508157](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113160508157.png)

# BCNF

每个函数依赖的左边都必须是候选码，完整的候选码

![image-20240113160719614](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113160719614.png)

# 多值依赖和4NF

不是函数依赖的范畴了，一个x可以对应好几个y

![image-20240113161814884](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113161814884.png)

![image-20240113162050928](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113162050928.png)

排列组合

![image-20240113162114303](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113162114303.png)

这种有数据冗余，和插入删除更改异常

## 4NF

非平凡的多值依赖必须是函数依赖

将多值依赖一个一个切成几个函数依赖就行了，就是平凡的多值依赖

## 无损连接和保持函数的依赖

![image-20240113165618590](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113165618590.png)

![image-20240113165623280](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113165623280.png)

# 数据公理系统

![image-20240113171050781](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113171050781.png) 

![image-20240113171242882](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113171242882.png)

## 函数依赖集的等价

是俩个函数依赖集的函数闭包一样

##   最小函数依赖集

F+闭包是F的最大版本，Fmin是最小的函数依赖浓缩版本，但是Fmin的闭包也还是F+

右左中

![image-20240113181519241](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113181519241.png)

最小函数依赖集不唯一，中间部分去除函数依赖的顺序很重要

在中间消除的过程中，删了某个函数依赖，后面就不能用了。

最后一步去除左部冗余时，要去掉一个然后求他的闭包看能不能推出去掉的这个

## 正则覆盖

是在最小函数覆盖的基础上，最后进行相同左部的函数依赖的合并



## 候选码的求解

只在函数依赖左侧出现的肯定是码的一部分，只决定别人 ，left中的要全加上，如果left这些就足够就可以了，就是从最小的开始推，然后==如果不行就加上lr的就是即在左边出现又在右边出现==的



![image-20240113183953476](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113183953476.png)

## 无损连接

画表格，行是分解出的模式，列是出现的字母

针对每个函数依赖，去寻找左侧相同的几行，然后去修改函数依赖右侧的部分，如果有a，就改为a，如果都是b，就按照b最小的行数

将一个关系分解成3NF，就按照每一个函数依赖分成一个关系，然后去除是一个子集的情况，最后为了保证无损连接，加上一个候选码

## BCNF分解

不断地提取出函数依赖集中的一个函数依赖确认一个关系，然后从主关系中去除依赖集的右部分

![image-20240113200351944](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113200351944.png)

![image-20240113200357201](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113200357201.png)

不是简简单单的就一个函数依赖的直接推导，要取出这个属性的闭包，分解出来

![image-20240113201323473](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113201323473.png)

![image-20240113201333291](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113201333291.png)