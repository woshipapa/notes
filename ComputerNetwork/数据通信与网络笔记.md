# 数据通信与网络笔记

## 第一章

![image-20231213143648903](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213143648903.png)





使异构的设备（硬件不同，操作系统不同，数据编码不同的）设备之间实现通信

 

![image-20231213132825536](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213132825536.png)

![image-20231213132919026](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213132919026.png)

协议就是发送方与接收方之间的一组约定，数据编码，数据长度大小，传输速率等等

数据在传输前要先进行编码成**二进制**的格式

  单工只能有一种数据的传输方向，一般是中心源向其他的发送，比如广播电台，电视台



![image-20231213133428072](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213133428072.png)

网络准则

![image-20231213134045245](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213134045245.png)

### 连接的拓扑结构

多点连接会存在共用一条链路的情况，可能会有共享的冲突问题

#### mesh网状

不跟别人共享，**安全性机密性**也比较好

![image-20231213134919599](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213134919599.png)

![image-20231213134558940](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213134558940.png)

#### star星型拓扑

![image-20231213134931948](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213134931948.png)

![image-20231213134902642](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213134902642.png)

#### bus总线型拓扑

提前规划好了分接头多少个，长度

![image-20231213135155140](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213135155140.png)



![image-20231213135058571](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213135058571.png)

#### ring环状拓扑

![image-20231213135301862](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213135301862.png)

![image-20231213141100214](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213141100214.png)

![image-20231213142634887](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213142634887.png) 

### 协议的三要素

##### 语法

定义了数据信息的基本格式

![image-20231213143334638](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213143334638.png)

##### 语义

解释其中的含义，发送方与接收方对于数据的含义是共同的理解，知道收到后做什么操作，有什么响应

##### 时序

报文发送的一种同步关系

## 第二章

### 实体，协议，服务

对等实体之间是采用相同的协议，然后利用下层提供的服务，通过SAP（service access point）服务访问点进行获取服务，但他看不到下方的协议

![image-20231213144846910](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213144846910.png)

![image-20231213145005123](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213145005123.png)

### OSI网络模型

分层每一层都是相对独立的，各司其职

对等层之间通过协议进行通信，下方对他们来说是透明的，所以其实就像是直接通信一样，算是一种逻辑通信

，但实际上是需要用到下方提供的服务功能的

![image-20231213145646098](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213145646098.png)



![image-20231213150016564](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213150016564.png)

![image-20231213151203948](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213151203948.png)

#### 物理层

传输透明的比特流bit，物理层会把这些bit数据根据介质的不同，转换成电信号，光信号，无线信号在传输medium上进行传输

发送方与接收方时钟的同步信息

提供机械或者电气的一些特性

![image-20231213152152919](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213152152919.png)

**物理层负责从一跳（节点）**

**到另一跳（节点）的位（bit）**传递**

#### 数据链路层

进行纠错，**帧**（frame）从一跳到下一跳

进行物理选址MAC地址，确定好接收方的物理地址

通过调整发送窗口的大小以及发送速率来实现**流量控制**，要考虑接收方的处理能力，以及链路的带宽

![image-20231213152902018](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213152902018.png)

#### 网络层

packet

逻辑寻址IP地址和路由选择（选择一条link）

![image-20231213153439573](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213153439573.png)

#### 传输层

端口port的寻址

连接控制是TCP，面向连接的

与数据链路层的流量和差错控制的不同在于：

数据链路层是小范围的，一跳到一跳的控制，而传输层是一个进程到另一个进程范围更大的，并且网络层如果出现了错误也可以纠正

![image-20231213153940102](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213153940102.png)

#### 会话层

会话session建立在俩个结点之间的持续一段时间的交互连接

提供数据的同步，有很多个同步点，如果哪里传输失败，没必要全部重新传输，可以从距离出错最近的同步点开始传输



![image-20231213174911506](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213174911506.png)

#### 表示层

进行数据的加密解密，数据的压缩，数据的翻译（不同编码之间）

![image-20231213175347958](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213175347958.png)

 

### 寻址

#### 物理地址

**长度和格式是可变**的，用的最多的是6个字节48bit的地址

![image-20231213190446851](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213190446851.png)

#### 逻辑地址

ip地址，统一的标准

数据链路层就是负责一跳到下一跳的地址

![image-20231213191159981](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213191159981.png)

在跳一跳中，逻辑地址和端口地址是不会变的，物理地址可能会变化的

#### 端口地址

一般用16bit，会用十进制的数字表示端口号，比如8080端口

## 第三章.数据与信号

将文本，音频等信息编码成数据，然后转换成信号在传输介质上进行传输

我们关心

数据怎么变成信号，以及怎么传递

![image-20231213192224603](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213192224603.png)

模拟信号因为是连续的，受干扰能力较差，受到干扰会使波形改变明显

数字信号不会收到太大的影响，并且可以通过再生中继器重新生成，而不是简单的方法，要不然失真也会放大



![image-20231213192716460](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213192716460.png)

![image-20231213192952820](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213192952820.png)

### 模拟信号

复合信号由许多不同频率，相位，幅度的单一正弦信号构成，可以包含更多的信息

![image-20231213194033960](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213194033960.png)

周期性复合信号可以写成几个具有特定频率，也就是离散的频率的正弦波的和，所以转到频域就是离散的频谱图，带宽会更小

![image-20231213194700950](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213194700950.png)

![image-20231213195106460](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213195106460.png)

![image-20231213200306945](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213200306945.png)

### 数字信号

![image-20231213201455001](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213201455001.png)

比特率是bps，每秒传输的bit位

比特长度（位长）就是一个bit在传输介质上传输的距离

![image-20231213201800209](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213201800209.png)



数字信号的频谱图是无穷大，带宽也是无穷大

数字信号是无穷大带宽的复合模拟信号

![image-20231213202408099](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213202408099.png)

### 数字信号的传输

#### 基带传输

低通通道的频率是从0开始的，上限频率有高有低

![image-20231213202906358](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213202906358.png)

通过通道之后只剩下特定带宽的数据

宽带宽的信道可以让失真少一些，因为通过的频率会更多

![image-20231213203126010](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213203126010.png)

![image-20231213210134707](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213210134707.png)

比特率越高，这个信号的带宽越大

用模拟信号模拟数字信号时，用更高频率的谐波与基波叠加表示的数字信号越精确，但是带宽会越大

#### 宽带传输

这里用的不是低通通道，是带通通道，不是从0频率开始的，这里不能把数字信号直接通过信道发送，要先转换成模拟信号，要经过**调制**

因为数字信号的带宽是无穷大，但是带通通道只有一定频率范围的能够通过，为了减少失真就要进行调制成这个频率范围内的模拟信号

### 传输损失

#### 衰减

dB是用来表示相对的能量损失的，如果是负的表示损失了，如果是+的一般是经过放大

![image-20231213212642599](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213212642599.png)

![image-20231213212841282](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231213212841282.png)

#### 失真

波形在传输过程中形状发生了改变，不仅仅是幅度

#### 噪音

信噪比。信号的平均功率/噪音的平均功率，但一般也会用dB分贝去描述这种影响

![image-20231214102453877](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214102453877.png)

高信噪比的话，影响不大

### 数据速率限制

####  奈奎斯特定理

是在无噪声的情况下的比特率bps

与带宽和电平数有关

考虑一下如果只有0和1，我用最大带宽的2倍进行采样，就基本可以保证采集到完整的数据可以恢复，但是电平数如果增加就要增大这个速率

![image-20231214104223972](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214104223972.png)

信号电平数的增加会增加接收方系统的复杂性，并且更难识别，而且在传输过程中出现问题更难识别，影响可靠性

#### 香农定理

定义了有噪声的通道特性，是**最高的数据速率上限**，没有电平

![image-20231214104444266](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214104444266.png)

![image-20231214104534469](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214104534469.png)

### 性能

#### 带宽

一种是Hz为单位的，表示频率范围

另一种是bps，表示数据传输速率

![image-20231214104813122](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214104813122.png)

#### 吞吐量

是实际的成功的传输速率，单位时间成功的传送bit的数量

#### 时延

##### 传输时延（发送时延）transmission

是指把一个报文从结点完全进入传输媒介的时间，就是报文的长度除以他在这个媒介中的带宽

![image-20231214105820386](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214105820386.png)

##### 传播时延propagation

就是在路上花的时间了，是传播距离/传播速度

![image-20231214105903024](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214105903024.png)

##### 时延带宽积

带宽*时延，就是这个通道中位的数量

![image-20231214110815079](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214110815079.png)

## 第四章.数字传输

数字或者模拟的数据转换成数字信号

###  线性编码

数据元素是信息的最小实体，是要被承载的，可以理解为乘客，信号元素是要载体，是信号的最小单元

比率：一个信号元素承载的数据元素的数量

![image-20231214114157514](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214114157514.png)

![image-20231214114208123](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214114208123.png)

![image-20231214114405184](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214114405184.png)

数据传输速率是比特率，单位时间内传输的bit的位数

信号的传输速率是波特率，是单位时间内传输的信号数量，这肯定是与r比率有关，我们希望用更少的信号，发出更少的信号来承载更多的数据位

![image-20231214114904702](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214114904702.png)

![image-20231214114954928](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214114954928.png)

波特率与带宽是有直接关系的

波特率一定，就能求出带宽的最小值

带宽一定，就能够求出波特率的最大值，可以类比成车与交通的关系

![image-20231214115509210](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214115509210.png)

#### 一些问题

基线是接收方收到的信号的平均功率，作为对信号进行解码的标准，如果是一长串的0或者1会导致基线也就是平均功率的偏移导致判断不准确

直流分量是在频谱图中f==0的地方还有能量幅度的，直流信号不能通过电容，并且会给器件造成老化

![image-20231214120428003](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214120428003.png)

在发送信号与接收信号的一方中要使用相同的时钟间隔进行配对，就是要明确哪个是信号的起始位置，中间，终止位置

![image-20231214120718649](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214120718649.png)

![image-20231214120818172](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214120818172.png)

![image-20231214121403342](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214121403342.png)

#### 线性编码方案

##### 单极性编码unipolar

NRZ不归零，就是在表示一个数据元素的过程中没有归0

这个有基线偏移的问题，长串的数据元素0或者1会导致平均功率变化，还会有直流分量

![image-20231214121706238](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214121706238.png)

##### 极性编码polar

有x轴的上方和下方表示

分为电平和反向编码

NRZ-L是根据数据元素是0还是1来选择高低电平的表示

NRZ-I是反向，看下一位如果是1就反向，如果是0就保持

仍然具有直流分量，NRZ-L遇到长串的0或者1还是会基线偏移，NRZ-I对于1没事，因为会一直反向，但如果是0就不行

![image-20231214122501451](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214122501451.png)

自同步问题，NRZ-L在一连串的0或者1，接收方是无法判断哪一个是一段的开始或者结束的

NRZ-I遇到1会跳变，接收方根据越变能判断出，0也不行

![image-20231214123058110](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214123058110.png)

极性RZ归零码

这里的比率一个数据元素对应了俩个信号元素（电平），所以r=1/2

![image-20231214123913196](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214123913196.png)

#### 双相码biphase

曼切斯特编码结合了极性RZ码的跳变和NRZ-L

0是要从高电平跳到低电平，1是要从低电平跳到高电平

==边缘跳变==，当前位置与下一个数据元素的要求不一样就要跳

![image-20231214124711572](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214124711572.png)

![image-20231214124720224](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214124720224.png)

差分曼切斯特编码其实就是规定了边缘跳变规则的，然后中间总是要跳变的

NRZ-I 反向跳变的思想+RZ的中间跳变

如果下一位是0我要跳变，1的话保持

![image-20231214125515807](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214125515807.png)

曼切斯特是结合了NRZ-L的电平法，0是要高的，1是要低的，然后边缘的跳变就取决于当前的位置和下一个数据元素的要求

注意**初始值**

中间的这种跳变可以抵消，没有基线偏移的问题

没有直流分量，但是带宽会大一点，信号的速率会大一些

![image-20231214130444871](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214130444871.png)

曼切斯特是在如果在中间由高到低就是0，由低到高就是1，这是**值在中间**

差分曼切斯特由于是看下一位，是在值在起初位置

### 双极性编码

就是用俩种极性，一个正电平一个负电平表示同一个数据元素的交替

这样可以抵消掉，没有DC和基线偏移问题

![image-20231214131514135](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214131514135.png)

![image-20231214131522267](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214131522267.png)

AMI对于长0有自同步的问题

![image-20231214133010454](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214133010454.png)

### 块编码

进行冗余

![image-20231214133452389](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214133452389.png)

##### 4B/5B

解决了NRZ-I的长0问题，多增加了一位表示，避免了长0的出现，最多出现三个连续的0，因为开头最多一个0，然后中间的0最多俩个，一定程度上减轻了自同步的问题，还有基线偏移的问题

并且冗余一位多出的表示可以当作纠错的，出现了表中没有的编码

![image-20231214172437957](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214172437957.png)

![image-20231214172656862](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214172656862.png)

![image-20231214172931219](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214172931219.png)

### 扰码



![image-20231214173125671](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214173125671.png)

##### B8ZS

这里在前面AMI的基础上，V表示违反就是与上次的非零极性保持一致，因为按照AMI的交替正负极性来说，应该是相反的，但这里是V就是违反，B是保持相反极性

![image-20231214173419367](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214173419367.png)

#### 记忆点

NRZ-L中是0为高电平，1为低电平

相应的曼切斯特编码因为借鉴了NRZ-L，所以0是从高---->低，1是从低----->高

NRZ-I是当下一位为1时，要反转，差分曼切斯特与他相反

特别注意非归零码NRZ系列只需要考虑每一个数据元素的最初值，中间不会跳变

但是双相码中间也是会有跳变的，除了考虑边缘以外

## 模拟到数字的转换

### PCM脉冲码调制

采样，量化，编码

 ![image-20231214183935213](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214183935213.png)

理想的采样就是采取一个点一个点的

但实际上比较方便的采样是小矩形，每次采样的间隔为Ts，方形采样的时间较短的话就可以近似成采样一个点

![image-20231214184333207](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214184333207.png)

奈斯斯特定理定义了，采样频率一定大于原始模拟信号最高频率的2倍，这里的采样频率的规定主要是为了接收方把这个离散的数字信号还原回模拟信号

![image-20240101220703775](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101220703775.png)

![image-20231214185053160](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214185053160.png)

![image-20231214185502926](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214185502926.png)

采样频率时俩倍的信号最高频率，一般就是会在一个周期内采取俩个点

量化

![image-20231214191254510](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214191254510.png)

![image-20231214191343941](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214191343941.png)

![image-20231214194133351](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214194133351.png)

用nb位表示量化等级

每秒采几个样本，每个样本由几位组成

![image-20231214194650049](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214194650049.png)

![image-20231214195124849](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214195124849.png)

### 传输模式

![image-20231214200149120](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214200149120.png)

![image-20231214200210993](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214200210993.png)

#### 异步传输

每个字节之间的时间间隔不确定，所以接收方不确定数据啥时候到达，所以要带上起始位置和终止位置以告诉接收方

是字节级别的异步，字节之间不需要同步了，增加一个开始的标志位和结束的标志位，但是字节中的位依然是要保持同步的，每个字节间还有时间间隔

![image-20231214200653045](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214200653045.png)

#### 同步传输

同步传输的bit是连续的，其中的同步信息包含在编码中

以位流的方式传输，要保持高度的同步

![image-20231214201334267](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231214201334267.png)

# 第五章.模拟analog传输

使用模拟信号传输，可以实现全双工通信

Modulartor调制



![image-20231218193023979](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218193023979.png)

## ASK

用幅度承载数据元素

用不同幅度的正弦波来表示数字

这里带宽为什么为 1+d，d是[0,1]，因为模拟信号的频带可能没有负频率，选择用一部分的，数字信号只用一般所以就是S，这里可能全部用到就是2S

BASK(2个)

![image-20231218193309319](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218193309319.png)

![image-20231218194327495](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218194327495.png)

这里也可以用4个幅度来承载，这样的r就是2，一个信号元素承载俩个数据元素

## FSK

BFSK：用俩个频率的正弦波承载数据元素0和1

使用电压控制的晶振产生不同的频率

因为使用了几个不同的频率，所以一个信号元素的带宽会有好几个这种组成

![image-20231218200034214](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218200034214.png)

![image-20231218194845674](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218194845674.png)

## PSK相位

比ASK更抗干扰，因为噪声一般影响到幅度不容易影响到相位

![image-20231218200145580](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218200145580.png)

![image-20231218200337710](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218200337710.png)

这里的0不再是0了，而是负的，是为了和1区分正负，以便让载波颠倒相位

### QPSK(4PSK)

利用正弦波和余弦波的相位相差PI/2，可以产生4个相位的，因为可以传2位，r=2

但这里其实就是用到俩个BPSK

![image-20231218201119706](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218201119706.png)

### 星座图

用极坐标描述振幅和相位，假设频率都相同

![image-20231218202036399](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218202036399.png)

## QAM

调幅和调相一起

![image-20231218202321688](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218202321688.png)





# 第六章.带宽利用

合理利用带宽，提高利用率

![image-20231215181611515](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215181611515.png)

## 复用

多个信号共用一条通信链路，共享此链路

![image-20231215181934273](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215181934273.png)

![image-20231215181924105](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215181924105.png)

频分和波分是用于模拟信号，时分用于数字信号，当然可以进行转换成某种信号

### 频分多路复用

就是将信道的带宽逻辑上划分为几个不同的频率范围，然后将**模拟**信号用不同频率的载波进行调制，但一定要注意不能有重叠，然后发送到接收方后，在使用那几个不同频率的载波进行解调![image-20231215183105019](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215183105019.png)

![image-20231215183110531](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215183110531.png)

![image-20231215183243177](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215183243177.png)

为了几个频率带的交叉重叠，可以中间空出来就是加上**防护频带**

![image-20231215183711729](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215183711729.png)

### 波分多路复用

用于光信号，将多路光信号变成一路光信号

基本原理与频分复用相似

![image-20231215184451950](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215184451950.png)

利用三棱镜的折射将多路变成一路，然后分离时将一路变成多路

![image-20231215184630591](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215184630591.png)

### 时分多路复用

将每个用户的数据切成n个小片，然后在frame帧中每个用户交替的占据这个帧

每个用户的几个小片会周期性的出现在帧的同一个位置中

比如1s中，我分了10份，一份的时间间隙就是0.1s，每一个0.1s就给一个用户使用

![在这里插入图片描述](https://img-blog.csdnimg.cn/5b8c409d2fc04485a8945de192b2ec8a.png)

n个用户的数据，假设都划分为n份，每一份的传输时间为T，那么总共就是n2T,因为这是挨个用户发，不是交替的

使用同步的TDM之后，一个帧就由这n个用户的数据切片组成，每个用户占据一个帧的一个时间间隙，一个帧的传输时间还是T，但是此时只需要n个帧，也就是nT的时间

所以提高了n倍的速度

![image-20231215191256876](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215191256876.png)

![image-20231215191638555](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215191638555.png)

输出帧的速率与任一的一个输入速率相同，原来一个是1Mbps，现在就是1000000帧每秒钟，然后再结合一个帧含有多少位就能求出比特率

==这里帧的速率啊==，每秒发出多少帧，这么想，假设输入的速度为100字节/s，输入的单位为2个字节，那么1秒钟，相当于有100个字节，我帧是每一个帧需要这个输入的2字节，那不就是50帧/s嘛

注意题中说的输入单位是已经划分好的1/n那一个单元就是T的时间

帧的传播速度就是输出帧的速率，就是一秒钟多少帧，根据这个就可以求出比特率

输入位持续时间

输出位持续时间会是输入位的时间的1/n

但是输出位合并成一个帧的，这个帧的持续时间是和输入单位的持续时间相同

最终的数据速率就是帧的速率（帧/s）*帧长（bit/帧）

空间隙会导致一些时间片的浪费

![image-20231215195531473](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215195531473.png)

在多路复用的时候，可能每一路他们的数据速率不都是相同的，就要采取措施

帧指示位保证同步的可能带来额外的开销，增大带宽

![image-20231215203159163](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215203159163.png)

![image-20231215203203712](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215203203712.png)

![image-20231215203209182](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231215203209182.png)

### T-1帧

美国标准

考虑每个帧的同步位

T-1就是24路的64kbps合在一起，1.544M，要加上帧同步位

一秒钟8000个样本，所以帧的传输速率是8000每秒

![image-20231218204649066](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218204649066.png)

![image-20231217233119915](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217233119915.png)

![image-20231217233110493](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217233110493.png)

![image-20231217232852559](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217232852559.png)

### E-1帧

![image-20231217233128776](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217233128776.png)

### 扩频

抗干扰和保密

#### 跳频扩频

![image-20231217230911046](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217230911046.png)

伪随机的码字与频率表中的频率进行对应

![image-20231217231046621](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217231046621.png)

送到频率生成器，然后生成该频率与原始信号进行调制

一个周期内是随机的，但整体来看不是随机的

![image-20231217231333844](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217231333844.png)

来回跳频可以有效的保密和抗干扰

为了充分利用带宽，但是因为每一个时间段信号的频率不同，所以会在不同的频带内传输，而不像FDM的频分就一直固定的在某个频带

![image-20231217231735706](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217231735706.png)

#### 直接序列扩频

![image-20231217232416833](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217232416833.png)

![image-20231217232425211](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231217232425211.png)

# 第七章.传输介质

不属于物理层

有线介质和无线介质

![image-20231218210119424](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218210119424.png)

双绞线是俩根线扭在一起，俩根是为了差分，减掉噪声的干扰

渐进式的这个内芯的密度不是一致的，随着半径变化，可以减少能量损失，传播更远，能量集中

![image-20231218211607667](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218211607667.png)

大气电离层的密度（折射率）是随高度逐渐减小的，所以无线波会逐渐的变成全反射，短波

微波就可以近似直线用卫星传输



![image-20231218212608101](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231218212608101.png)

# 第九章

QAM进行调制和解调，就是根据星座图，给不同的数位组合使用星座图上的不同点来表示，也就是振幅和相位不相同的正弦波来模拟

下面使用了频分复用，将大的带宽充分利用

ASDL不对称

![image-20231219114213322](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219114213322.png)

# 第八章.交换



![image-20231225142346892](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225142346892.png)

通信子网节点就是路由器或者交换机，进行一跳一跳的交换，含有通信子网节点的就是**交换网络**

 

![image-20231219114903050](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219114903050.png)

## 电路交换

FDM/WDM+TDM，假如是光纤传输，那么波分复用的每个波频率中，在进行时分复用



![image-20231219115743561](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219115743561.png)

电路连接建立好之后，一直占用着链路的带宽资源，用户如果长期不用，并且语音中会抑扬顿挫效率会很低，就会很浪费

![image-20231219131342159](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219131342159.png)

## 分组交换

### 数据报交换

几个分组发出去，路由器根据当前的网络状态动态选择路径，可能会造成乱序的情况，但是上层会进行处理

交换机进行存储转发工作

![image-20231219131546502](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219131546502.png)

![image-20231219131600746](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219131600746.png)

![image-20231219131813318](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219131813318.png)

![image-20231219132039907](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219132039907.png)

![image-20231219132125491](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219132125491.png)

缺点就是增加了排队时延和额外的首部位开销

### 虚电路网络

规定好了发送地到目的地的路径

也要事先的建立好连接，实际上就是在发送连接和确认连接的过程中进行完善路由表

![image-20231219132603770](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219132603770.png)

![image-20231219132808169](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219132808169.png)

分组交换形式的还可以流水线传输





# 数据链路层

# 第十章.检错与纠错

### 差错类型

单比特错误就是随机的对一位产生了错误，突发错误是很多位是相关的因素导致的错误

![image-20231219133602303](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219133602303.png)

![image-20231219133644340](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219133644340.png)

### 分组码（块编码）Block Coding

**模2运算**就是将值卡在0和1，其实就是**异或**xor

冗余可以和数据不掺杂在一起，就是系统码，否则是和数据你中有我，我中有你的



![image-20231219134102946](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219134102946.png)

![image-20231219134403303](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219134403303.png)

检错码只是能够知道有错误，但是纠错码可以定位错位进行修改

![image-20231219141831426](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219141831426.png) 

![image-20231219142304772](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219142304772.png)

### 汉明距离

![image-20231219142752255](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219142752255.png)

![image-20231219142923634](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219142923634.png)

一对一对的

![image-20231219143032862](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219143032862.png)

汉明距离是被破坏的位数

这一组码字的最小汉明距离说明了这个接收方收到的正确码字可以被识别的最少的不同位数，假如我要检测s个错误，但是最小汉明距离就是s，那么s个错误说明了接收到的和发送的会有n位的不同，因为最小汉明距离也是s，所以有可能就因为这个错误就被错误的识别成正确的码字了

但如果是s+1为最小汉明距离的话，==就不会错误识别，为了保证能够检错==

位于圆周上和圆周内可以纠错回x，否则会误判

出错最多s位，就是s位发生了改变这个数据字，但是最小汉明距离就是俩个有效的码字之间不同位的个数如果大于s位，肯定不会误判

 ![image-20231219144430980](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219144430980.png)

为了在出错后能够纠错，就需要保证俩个圆是相离的

![image-20231219144930907](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219144930907.png)

![image-20231219145004277](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219145004277.png)

检测s个错误。最小汉明距离是s+1

纠错码的最小汉明距离为奇数

### 线性块编码

任意的俩个码字异或之后都能得到其他的有效码字



![image-20231219145535791](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219145535791.png)

![image-20231219145920566](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219145920566.png)

因为任意俩个异或都是表中的有效码字，然后1的个数就是汉明距离，所以1的个数最少的就是最小汉明距离



#### 奇偶校验码

通过添加一位（r=1）来使1的个数为偶数个，最小汉明距离为2，所以最多检测1位错误

![](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219150226385.png)

![image-20231219150446585](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219150446585.png) 

可以检测出奇数个错误

 根据最小汉明距离的推断，==1位是肯定能够检测出来的==，多位是不一定的

#### 二维奇偶校验

![image-20231219151409200](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219151409200.png)

![image-20231219151615678](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219151615678.png)

![image-20231219152259294](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219152321174.png)

三位和三位以下无论怎么排列都可以检测出错误，奇数位也可以，但是偶数位不一定



#### 汉明码

m就等于冗余位数 

![image-20231219152809543](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219152809543.png)

![image-20231219153124311](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219153124311.png)

汉明码冗余的每一位其实就是类似的奇偶校验码的计算 。偶校验，1的个数为偶数

如果没错，校验子s0s1s2都是0

如果是校验位错了无所谓，无须做处理，数据部分没有错

![image-20231219153743999](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219153743999.png)

根据校正子的值可以判断出是哪一位有问题，就是根据下方的式子关系，要联系的看

![image-20231219154239893](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219154239893.png)

![image-20231219154347216](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219154347216.png)

每一列一起发，所以各个码字不是连续的，可以突发性错误的N位平摊到每一个码字中

![image-20240103225201678](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240103225201678.png)

#### 循环码

一定注意生成器中的除数是n-k+1就是比冗余位多一位

模2除法就是异或



![image-20231219160243899](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219160243899.png)

多项式的减法和加法一样，就是他们前面系数1或者0的模2运算

![image-20231219160636658](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219160636658.png)

![image-20231219161017759](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219161017759.png)

![image-20231219161613933](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219161613933.png)

好的生成多项式是尽可能地不能误判，就是明明错误了，但认为是正确的

就是ex/gx不能为0

##### 单比特错误

==判断依据==

![image-20231219170203311](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219170203311.png)

![image-20231219162111147](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219162111147.png)

  ![image-20231219162508444](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219162508444.png)

俩个独立的单比特错误，是提取出来一个小的然后系数做差就是相邻了几项

##### 奇数个差错

![image-20231219162737959](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219162737959.png) 

##### 对于突发性的错误检错

j-i就是相差的最大位，=L-1

![image-20231219170522568](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219170522568.png)

# 第十一章.数据链路控制

数据链路不仅仅是物理链路，更是加了协议控制的软硬件结合

![image-20231219185148983](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219185148983.png)

![image-20231219185239076](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219185239076.png)

## framing成帧

帧的标识位不包含在帧的长度里

可变长度成帧是说数据部分的长度可变

面向字符型的帧，控制信息通过一些字符编码的加入来控制，但是如果俩台电脑采用不同的字符集就会有问题，并且如果控制信息出现在数据段也会有问题

![image-20231219190635840](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219190635840.png)

ETB是如果正文段被分成了好几组，他会在每一组正文段的结束加上ETB，整个正文的结束加上ETX

![image-20231219193016777](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219193016777.png)

正文中出现了控制字符，要加上**转义字符**

![image-20231219193255176](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219193255176.png)

![image-20231219193617178](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219193617178.png)

BSC是一种半双工的工作模式，按照顺序来，发送方接收到ACK或者NAK才会发送



![image-20231219193853706](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219193853706.png)

### 面向比特位的帧

控制位出现在了数据位，0后面5个1时插入一个0，进行位填充



![image-20231219194026794](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219194026794.png)



注意如果这五个1后面是一个0，也依然会填充**0**![image-20240107235128924](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240107235128924.png)

## 流量控制和差错控制

根据接收方接收的能力来动态调整发送的速率

![image-20231219194421348](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219194421348.png)

![image-20231219194717136](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219194717136.png)

### 无噪声信道

理想情况，不需要考虑差错控制，然后引出俩种情况，考不考虑流量控制

#### simplist

假设接收方的处理能力高于或者等于发送方的发送能力，并且假定不会出错

![image-20231219195029735](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219195029735.png)

![image-20231219195329457](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219195329457.png)

#### stop-and-wait

通过这个发送之后等待，可以保证流量控制，不会出现发送方一直发送

收到ACK之后并且网络层在发送数据才可以发送数据

![image-20231219195623514](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219195623514.png)

![image-20231219200052816](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219200052816.png)

### 有噪声信道

加上差错控制

#### stop-and-wait ARQ

![image-20231219202333641](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219202333641.png)

重传，发送前会保存帧的副本，并且有计时器，超时的可能有发送的帧丢失了（就是接收方没收到），还有可能是接收方的ACK丢失了（接收方收到了），还有可能就是发送和接收的时间太久真的超时了，此时都会超时，我要重传，但是俩种情况，重传 后不一样，接收方收到了重传就要识别出来这个我以前受到过了，**区别重复帧**

**对帧进行编号**

![image-20231219201126417](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219201126417.png)

停止等待协议的编号只需要一位即可，0和1，因为他只会发送方在发送时假如发的序号0，然后接收方接收到后，发送ACK1，表示1之前的都收到了，请求的下一个为1，然后他在发1，接收方在重复利用0就可以了，不存在多个的情况，因为这是按照顺序的发送

![image-20231219202448208](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219202448208.png)

接收方在收到重复帧后，会再次给发送方发送ACK，这里面ACK的序号表示接收方当前需要的某一个序号，然后发送方就知道了要发送这个，说明他重复发了

![image-20231219204217484](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219204217484.png)

![image-20231219204515374](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219204515374.png)

  

#### GO-BACK-N ARQ 回退N帧 ARQ

停止等待协议中，序号位只有一位，因为发送方发出一个数据后等待确认之后才发下一个

发送窗口内的序号帧才可以发送，有的是已经发送了然后在等待确认的序号，有的是还没有收到网络层的发送请求的序号

Sn指向下一个要发送的帧，Sf指向最早的一个还没有得到确认的发送帧

 ![image-20231219210743678](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219210743678.png)

序号的个数使序号位m的2的m次方，但是窗口的最大大小为2的m次方-1==，这里是为什么呢？==

因为窗口过大会导致错误的接收，并不是期待的内容

![image-20231219213435934](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219213435934.png)

一下滑动多个时隙，可以是一个ACK，表示的是**累计确认**

![image-20231219211615683](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219211615683.png)

![image-20231219211637117](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219211637117.png)

![image-20231219211645701](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219211645701.png)

接收窗口的大小只有1，假设现在Rn在3，来了序号4的我就会丢弃，然后发送方计时器超时就会重新发送，**注意啊这里接收方是不响应的**，不会像上一个协议会发送自己需要的ACK序号

失序了之后，就要回退n帧，就是现在需要第3帧，但是你给我来了4，5，6帧我就会丢弃，一会还要重新发送

注意这里的重新发送，是把当前过期的这个帧和他后面的一起发送，这就是回退了n帧，然后接收方收到了很多，滑动好几个格子，发送一个累计确认

![image-20231219212617795](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219212617795.png)

ACK也要确认没有被干扰，因为ACK中包含了累计确认的序号，如果ACK错误了，就等着超时重发

累计确认机制使得如果ACK丢包了，也没关系，后面的ACK只要收到就能保证发送窗口滑动

![image-20231219214717010](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219214717010.png)

![image-20231219214721974](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219214721974.png)

![image-20231219215030526](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219215030526.png) 

#### Selective-Repeat-ARQ

在有噪声的信道下，帧是很容易出现差错的，如果采用回退N帧会有大量重发的帧占用带宽，效率低下

回退N帧多发了很多帧，浪费了带宽资源，效率低下

发送窗口变小了，-1在指数上了

![image-20231219215803546](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219215803546.png)

![image-20231219220007634](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219220007634.png)

选择性重传，不需要全部重传，因为有的已经缓存在接收方的缓冲区里了

也是累计确认，但是每个帧都有定时器

 ![image-20231219221559468](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231219221559468.png)

回退N帧的接收方是比较摆烂的，当你发来的帧出错时，他不会去发送确认消息，而是sleep，等着你发送方的计时器超时就会再次发送，而且如果发的帧不是他的预期他也不会有任何动作，也是等定时器过期，定时器一旦到时间了，就会把Sf左边界到Sn的就是已经发送但还没有得到确认的全部发送

选择性重传是每个序号帧都会有一个定时器，可见回退N帧的定时器对整个窗口的控制，当窗口中已经发送的但没有得到确认的帧出现了问题比方说帧出错，超时等等，他就会重新发送这个窗口内已发送但未确认的所有帧，但是选择性重传是精确的控制到每一个帧，只有这一个帧出现问题他就只会精细的传这一个，而不是所有

![image-20231220105951105](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220105951105.png)

这里多了NAK，其实一定程度上就是减轻了定时器的压力，不需要每次都是超时之后才重发了，这说明接收方也没那么摆烂了，他是假设这个帧出错了或者不是我预期得到的Sf的帧的序号时就会发送NAK（序号为Rn的就是接收方期待收到的第一个序号），然后发送窗口就会发送，这里如果是ACK依然是累计确认

![image-20231220113052181](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220113052181.png)

![image-20231220113407507](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220113407507.png)

#### 传输和传播时间的计算

tf是传输时间，ACK相比于发送的数据过小了，所以忽略他的传输时间

tp是传播时间来回都不能忽略

![image-20231220122633413](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220122633413.png)

![image-20231220122642701](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220122642701.png)



![image-20231220123627507](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220123627507.png)

利用率也就是效率是 发送的帧的总的**传输时间**/总耗时，这里就是有用的时间，也就是传输时间，如果要利用率高，就要在总时间内发送尽量多的帧，这就可以算出帧数

效率如果按照最大的窗口数*一个帧的时间/总时间，可能超过100%，所以效率最大化的时候其实是总时间/一个帧的时间得到**最多一次性传的帧数**

注意当发送窗口中的多个时，分母也是考虑一个帧的传输时间加往返时间内，在这段时间内的有效时间就是传输的帧的个数*传输时间

**==信道利用率==**：指发送方在一个发送周期的时间内，发送有效数据所需要的时间占整个发送周期的比率。发送方从一开始发送数据，到收到第一个确认帧为止，称为一个发送周期 T TT。发送方在这个周期内共发送 L 比特的数据，发送方的传输速率为 C，则发送方用于发送有效数据的时间为 L / C。则在这种情况L/C/T

![image-20231220125803730](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220125803730.png)

连续的发送几个比特或者几个字节的数据，他们的传播时间是只有一个也就是**最后那一个的**

![image-20231220133416890](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220133416890.png)



## HDLC 高级数据链路控制协议

### 正常响应方式

双方地位不平等，只有在主站发出命令后，从站才能进行数据传输也就是发出响应

![image-20231220114046569](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220114046569.png)

### 异步平衡方式

双方地位平等，双方都可以互相发送命令和数据

![image-20231220114145533](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220114145533.png)

### 帧的结构

![image-20231220114713555](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220114713555.png)

Flag用于标识这是一个帧

Address位为从站的地址

Control带有帧类型的码和命令的信息编码

FCS使用循环冗余CRC码进行校验

#### I-frame信息帧

可以进行数据的传输，然后也可以带上序号，可以进行重传或者排序

使用**捎带**机制，发送方既可以指定当前发送的帧的序号，也可以带上已经收到了接收方发送的帧的ack

信息帧中NS和NR是指发送帧的序号和ACK的序号。PF是轮询/终止，主站给从站发数据时意味着轮询，从站向主站发送时意味着终止

![image-20231220115154276](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220115154276.png)

Code段根据不同的值是表示不同的控制信息

#### S-frame管理帧

可以有ACK的序列号，用于接收方的响应

管理帧不携带数据，仅用于控制，ack或者nak

![image-20240108010543665](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108010543665.png)

![image-20231220115425146](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220115425146.png)

#### U-frame无编号帧

主要用于链路的建立和断开，一些控制信息

![image-20231220115851907](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220115851907.png)

ack

# ![image-20240108011248477](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108011248477.png)

# 第十二章.多路访问

![image-20231220134224952](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220134224952.png)

![image-20231220134400597](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220134400597.png)

## 随机访问协议（竞争访问）

每个站点的地位是平等的，没有谁可以控制谁不能发，他们的传输也是随机的，不知道啥时候会发送



### 纯ALOHA

不受控制的，有要发的就发

随着尝试的次数的增多，等待的随机时间的范围会增大

![image-20231220135447294](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220135447294.png)

![image-20231220150535843](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220150535843.png)

这里吞吐量中的G是一个帧传输时间内产生的帧的平均数量

![image-20231220151005061](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220151005061.png)

![image-20240108213032097](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108213032097.png)



### 时隙ALOHA

有了一个时隙才发帧，规定了每个站点只有在每个时隙开始的时候才能发

![image-20240108213637883](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108213637883.png)

![image-20231220151331689](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220151331689.png)

![image-20231220151345968](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220151345968.png)

### CSMA 载波侦听多路访问

在发送数据之前会先检测信道，就是说话前先听

载波信号如果还没到达监听站的话，我是不知道有载波在这个信道上的，所以此时发送的话会导致冲突，这主要是因为propagation传播延迟

![image-20231220152151609](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220152151609.png)![image-20231220152028857](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220152028857.png)

![image-20231220152342816](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220152342816.png)

#### 信道忙时的不同策略

##### 1-坚持

如果信道忙，一直监听，等到空闲了立即发送

![image-20231220152903546](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220152903546.png)

##### 非-坚持

如果信道处于忙的状态，等待随机的时间在进行监听，如果空闲了立即发送

但是这样可能会造成信道利用率的降低，就是此时信道可能没有传输的了，但是还在等待，但是确实可以降低冲突的概率，和1-坚持正好相反

和1-坚持在遇到信道空闲时都一样，都会立即发送，只不过是在信道忙时不会一直等待，而是等待一个随机时间

![image-20231220153128012](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220153128012.png)

##### P-坚持

![image-20240108215814337](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108215814337.png)

介于1-坚持和非-坚持之间，结合了俩者的优点

信道忙的时候会随机等待时长后在进行监听，空闲的时候并不是立即发送，而是有概率

，p的概率发送，1-p的概率下一个时隙在发送

发送之前先监听，是一直监听，就是如果信道忙也一直监听，如果空闲了，以p的概率发送，或者以1-p的概率推迟到下一个时隙，重复这个过程直到发送成功或者这个时隙忙，此时会等待一段时间后，在进行监听

![image-20231220154542423](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220154542423.png)

![image-20231220153507401](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220153507401.png)

![image-20231220153840412](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220153840412.png)

### CSMA/CD 带冲突检测的载波侦听多路访问

Carrier Sense 载波监听，发送之间先监听，CD的冲突检测是边发边听

C在t3时刻，发现了A已经传递到了C这里，但是C已经发出去了一部分，此时会停止发送，但是C已经发出了前面的一些，在t4时刻到达A，如果此时A还没有发完，A检测到也会停止

我们想一下临界的冲突时间就是当A的第一个比特刚到C，C此时也发了一个比特出去，C现在停止了发送，然后等待C的这第一个比特到达A之后A的最后一个比特刚发出去此时发生了碰撞，这时的时间（一个帧的传输时间）就是2倍的传播时间propagation，如果大于这个时间间隔发送的话，肯定不会相撞

所以为了能够检测出来的话，最小的帧长度就是 一个帧的传输时间*带宽



![image-20231220172857850](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220172857850.png)

![image-20231220171850101](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220171850101.png)

![image-20231220174500401](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220174500401.png)

最短的时间是双方同时开始发，然后双方都检测到碰撞就是一个传播时间



![image-20231220175240291](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220175240291.png)

最小帧长就是为了保证双方都可以检测到碰撞，然后停止发送，减少对信道带宽的浪费

![image-20231221174311618](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221174311618.png)



![image-20231221175022249](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221175022249.png)

工作流程

采用了跟ALOHA一样的碰撞策略，采用随机时间的退避策略

刚开始是与CSMA一样选择一个监听的策略，就是信道忙干啥，信道空闲干啥，然后可以发送之后就判断现在传输完成了还是检测到碰撞了，如果都没有你就接着发然后监听，如果有在具体判断是哪一个，如果是碰撞了，就先发送一个干扰信号，然后采取随机数的避让时间，否则不是碰撞就是完成了，success

![image-20231220175744407](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220175744407.png)

有线的信道，当发生碰撞后，信号叠加在一起，会使能量很高，就方便检测出来

![image-20231220180437060](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220180437060.png)

### CSMA/CA 带有冲突避免的载波侦听多路访问





## 受控访问协议

#### 预约访问协议

发送之间提前预约好了，哪个站点要发送，然后发送时按顺序来即可

![image-20231220181421191](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220181421191.png)

#### 轮询访问协议

有主站和从站，从站想要发送数据必须是通过主站的拉取poll，他才能发送，所以可以避免相互发冲突的情况

主站要发送数据给从站是通过选择的方式询问从站是否准备好接收，如果从站要发送数据给主站，主站会通过轮询的方式一个一个问

![image-20240108224503405](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108224503405.png)

![image-20240108224551073](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108224551073.png)

![image-20231220181516171](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220181516171.png)

#### 令牌环网协议

谁有令牌谁就可以享用信道的使用权

![image-20231220181728680](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220181728680.png)



![image-20240108224912583](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108224912583.png)

## 通道化

使不同的站点正交

### FDMA 频分多址（频分多路复用）

关注于多用户共享同一个信道，在物理层应FDM频分复用

一个站点占用一个频率带


是的，FDMA（Frequency Division Multiple Access）是依赖于FDM（Frequency Division Multiplexing）技术的。FDMA使用FDM技术为多个用户或通信设备分配独立的频率信道，允许它们同时在同一通信媒介上传输数据而不相互干扰。

FDM提供了多路复用的技术基础，允许多个信号在不同的频率信道上同时传输。FDMA则是这个技术在多用户环境下的应用，确保每个用户都有一个专用的频道进行通信。这种方式特别适用于移动通信和无线电通信系统，其中频谱资源是有限的，并且需要被有效地分配给大量的用户。

简而言之，FDMA是FDM的一种实际应用，用于多用户访问和信道分配。

![image-20231220182151270](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220182151270.png)

### TDMA 时分多址

一个站点的数据占用一个时隙

![image-20231220182214746](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220182214746.png)

### CDMA 码分多址

每个站点选择的码向量，使互相正交的

![image-20231220182359758](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220182359758.png)

![image-20231220182428565](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231220182428565.png)

# 第十三章.有限局域网

逻辑链路控制层和介质访问控制层

![image-20231221175605256](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221175605256.png)

![image-20231221175746866](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221175746866.png)

不同的局域网设备在LLC层都是一致的，是为了不同的设备也可以相互通信，但是在媒体接入控制层会有不同的地方，MAC子层

![image-20231221180003575](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221180003575.png)

![image-20231221180255993](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221180255993.png)

LLC层和MAC层都有成帧的功能

### MAC帧

前导符和SFD主要是用于时钟同步和告诉是一个帧的开始，这俩个是物理层加入的，不算帧的一部分

![image-20231221180815062](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221180815062.png)

总长度达不到64Byte，就会对数据部分进行填充padding

数据的最大长度和帧的最大长度不一样

![image-20231221181005033](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221181005033.png)

帧太大了，占用传输介质的时间长，而且接收方存储的缓存压力大

![image-20231221181232951](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221181232951.png)

MAC地址的6个字节，48位，表示成6组，一组是俩个十六进制的数，正好一组8位

就是以太网的地址，然后在第一组也就是第一个字节的第一个位如果是0，表示是单播地址，就是专门发给一个的，1的话是多播地址表示发给好几个，广播是多播的特例，广播的地址为全1，FF:FF:FF:FF:FF:FF

==MAC地址多播的判断==

![image-20231221181715392](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221181715392.png)

![image-20231221181729008](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221181729008.png)

地址中字节是从左往右发，字节中的位是从右往左发

第一个字节是47，所以就是最右面是4的从右往左写0010，7从右往左写1110

因为是每个字节中的位是从低位到高位传输，最先接收到的位就是多播地址位，从而就能判断是单播还是多播

![image-20231224151810094](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224151810094.png)

![image-20231221182128522](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221182128522.png)

![image-20231221182850536](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221182850536.png)

802.3标准中DSAP目的服务访问点会指明接收方上层的网络协议，SSAP是源服务访问点指明自己上层使用的网络协议，可以支持多网络协议的环境，LLC中的控制字段就是HDLC协议中的几种帧的控制字段

V2标准直接使用类型标明上层使用的协议

![image-20231221183015146](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221183015146.png)





假设有一个简单的网络场景，其中一个网络设备（设备A）需要向另一个网络设备（设备B）发送一个IP数据包。

#### 在以太网V2中

1. **数据包准备**：设备A准备一个数据包，其中包含了IP数据。
2. **以太网V2帧创建**：设备A创建一个以太网V2帧。这个帧包括：
   - 目的地址（设备B的MAC地址）
   - 源地址（设备A的MAC地址）
   - 类型字段：这里会设置为0x0800，代表IP协议。
3. **发送和接收**：设备A发送帧，设备B接收到这个帧。
4. **处理**：在设备B，网络接口检查类型字段，发现它是0x0800，因此知道这是一个IP数据包，并将其传递给IP协议栈进行处理。

#### 对比IEEE 802.3（使用LLC）

在一个使用IEEE 802.3标准的网络中，情况会稍微复杂一些：

1. **数据包准备**：同上。
2. **IEEE 802.3帧创建**：这里，设备A创建一个带有LLC头的IEEE 802.3帧。这个帧包括：
   - 目的地址和源地址
   - 长度字段
   - LLC头，其中包括DSAP和SSAP字段，以及控制字段。
   - 网络层数据。
3. **发送和接收**：设备A发送帧，设备B接收到这个帧。
4. **处理**：设备B首先处理LLC头，确定数据包的类型和目标协议，然后才能进行进一步处理。

### 优势分析

在这个例子中，以太网V2的优势在于其简化的帧结构和直接的处理方法。类型字段直接告诉接收端这是一个IP数据包，无需额外的步骤来解析LLC头部。这样，网络设备可以更快地识别和处理帧，特别是在高速网络环境中，这种效率是非常宝贵的。

相反，IEEE 802.3标准中使用的LLC子层虽然提供了更多的灵活性和对多种网络协议的支持，但它也引入了额外的复杂性和处理开销。对于许多实际应用来说，特别是那些对速度和简洁性有较高要求的应用，以太网V2的方法更为合适。

### 标准以太网的分类

![image-20231221184001541](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221184001541.png)

![image-20240110000227979](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240110000227979.png)





![image-20240110000232887](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240110000232887.png)



![image-20240110000239613](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240110000239613.png)

10BaseT双绞线就开始使用星型拓扑了

### 桥接以太网

带宽共享，总线型结构，共享一个信道

网桥将总线划分开了，冲突域划分了，可以**减小冲突碰撞**的概率，还可以**提高带宽的利用率**

![image-20231221184354781](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221184354781.png)

![image-20231221184540941](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221184540941.png)

那干脆在划分成每个主机一个域，专用的，就引出了**交换机**，此时CSMA/CD检测碰撞的协议就不需要了

![image-20240110000647504](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240110000647504.png)

![image-20231221184826159](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221184826159.png)



10BaseT是俩跟无屏蔽的双绞线连接，可以一根用于发送，一根用于接收，适合全双工

![image-20231221184850106](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221184850106.png)

### 快速以太网

放弃使用总线型拓扑

![image-20231221185217831](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221185217831.png)

# 第十四章.无线局域网

![image-20231221191239014](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221191239014.png)

 

无线局域网中不间断的监听信道代价太大了，CD是检测冲突

![image-20231221191511129](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221191511129.png)

引入了CSMA/CA，冲突避免而不是检测，CSMA/CA采用了**停止等待协议**

![image-20231222234502058](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222234502058.png)

![image-20231221192910912](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221192910912.png)

![image-20231221191829297](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221191829297.png)

![image-20231221191913475](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231221191913475.png)

## BSS

基本服务集，可能有AP，就是服务接入点，这一个服务集中的客户端可以通过AP与有线网络进行通信

![image-20231222224422112](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222224422112.png)

## RTS/CTS

**信道预约机制**

RTS是一种控制帧，在一个站点控制范围内的都会收到，**广播**的，也是告诉其他的，我要开始发了，你们不要发![image-20231222225118416](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222225118416.png)

RTS request to send请求发送数据，带有发送者和接收者的地址，以及传输数据需要的时间，接收者收到后如果信道可以用会发送CTS ，同时给所有的设备发送，可以解决隐蔽站问题，其他的设备就知道信道要被占用了，就不会发送了

隐蔽站在发给交叉的站点时，实际上碰撞了，但是由于他们离的远，互相又不能侦听到碰撞

RTS/CTS和数据帧都会携带**此次通信所需的时间**，其他站点就能知道信道要被占用的时间，而不需要真正的监听信道的信号，这是一种虚拟载波监听机制

![image-20231222224544509](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222224544509.png)

![image-20231222224735688](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222224735688.png)

![image-20231222224744701](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222224744701.png)

## IFS

帧间间隔，就是站点在检测到信道空的时候不是立即就发送帧的，而是要等待一个IFS帧间间隔再去发送

一个站点检测到信道空闲后，等待了一个DIFS进行发送，这里等待的原因是可能有更高优先级的帧要进行发送，所以等待了一个DIFS的时间

接收方收到后，等待一个SIFS，确保发送方有时间从发送状态切换为接收状态，然后发送一个ACK.

结束了这次的传输后，其他的站点等待一个DIFS，然后经过了一个随机的退避时间，这里是为了保证几个站点不会在检测到信道空闲后立马发送数据

![image-20240110234047989](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240110234047989.png)



## 退避算法

在检测到信道忙的时候会计算一个退避时间

当一个站点想要连续的发送数据时，第二次也要经过一个退避时间才可以发

当过了信道预约的时间也就是空闲时，每个帧就会进入自己的等待窗口时间，如果在等待过程中，又有要发送的帧他们就会暂停计时等待这个完成，重复以上步骤

![image-20231222233824353](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222233824353.png)

![image-20231222234849178](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222234849178.png)

![image-20231222234942634](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222234942634.png)

![image-20231222235849939](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231222235849939.png)

## NAV

![image-20231223000109273](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223000109273.png)

![image-20231223000133530](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223000133530.png)





每个站点只有在过了NAV这段时间之后才能够再去请求发送

![image-20240110233919826](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240110233919826.png)

在发送之前检测一下，然后要等待一个IFS，以便收到从远程站点收到的，等待完之后还要再检测一下，如果空闲了就可以通过RTS，如果是竞争窗口，在定时器作用的时间内也要监听，如果忙了就暂停计时器                                                        



![image-20240108223111422](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108223111422.png)



![image-20240108223217517](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240108223217517.png)

## 点协调

无竞争，轮询的方式，PCF的优先级比DCF更高，主要是因为间隔更短

![image-20240113205227806](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113205227806.png)

使用一个重复间隔来保证DCF不会轮不到

![image-20240113205437282](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113205437282.png)





## 帧格式

![image-20231223001039407](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223001039407.png)

这四个地址是最多会用到，一般就是会加上AP的MAC地址

fromDS和toDS中有一个是1，就表示是从分布式的有线系统发来或者接收的，都是1说明这个分布式的也是无线的

第二个就是fromDS是1，toDS是0

前俩个地址是最直接的就是当前的目标地址和源地址，第三个是从哪个BSS的站点发来的

第三个就是fromDS是0，toDS是1

![image-20240113211624723](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113211624723.png)



![image-20231223001219161](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223001219161.png)

![image-20231223001547762](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223001547762.png)



![image-20240113211941199](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113211941199.png)



# 第十五章.连接局域网，主干网和虚拟局域网

## 无源Hub集线器

只起到连接的作用，看成介质的一部分，在物理层以下

在这个例子中，无源集线器的作用主要是作为一个物理连接点，让多台电脑能够相互连接。但是，它不会处理或放大信号，也不会像交换机那样智能地管理数据流。因此，这种设备更适合于数据传输需求较低的小型网络环境。

## 中继器repeater

一般用于连接俩个网络段

在物理层，可以扩大覆盖的范围，衰减的信号可以**重新生成**，不是放大

![image-20231223125352702](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223125352702.png)

中继器只能连接在一个局域网下的不同网段

![image-20240113214509242](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113214509242.png)

## 有源集线器

物理层，多端口的中继器，也能扩大以太网的物理覆盖范围，集线器的不同接口的带宽要一样，因为集线器不能缓存数据，所以速率必须保持一致，否则使用最低的速率

中继器就俩个端口，不具备转发的功能也可以看成就是一个连接，但是有源集线器会广播转发

集线器和总线的逻辑是一样的，也都会碰撞

## 广播域

广播域是被限制在数据链路层之下的

![image-20231224154745310](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224154745310.png) 

![image-20231223132154533](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223132154533.png)

## 网桥

工作在数据链路层时，可以检查帧，就可以查看MAC地址，从而进行**过滤**，可以阻止进一步的广播，阻断

使用网桥之后可以隔离不同的，就像把总线切开了一样，划分了不同的冲突域，一个端口一个冲突域

网桥在决策时，有一定的处理时延，这里就是存储转发，但**不会改变帧的MAC地址**，不同接口可以是不同的带宽

![image-20231223132827418](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223132827418.png)

### 学习型网桥

网桥的过滤决策表根据哪个冲突域发到端口的就会**从from的MAC地址和这个端口**建立联系

学习的时候就是从哪个端口进来的就对应源MAC地址,进行决策的时候是对应的目的地址决定从哪个端口发出去

![image-20231224161741056](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224161741056.png)

![image-20231224161019836](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224161019836.png)

 ![image-20231223133813975](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223133813975.png)

如果网桥和LAN之间形成了环形，就会导致数据占据过多的带宽并且网桥的决策表会一直改变

![image-20231223134758963](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223134758963.png)

这里使用最小跳数来生成这个没有环路的最小生成树

![image-20231223134829895](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223134829895.png)

![image-20231223135020581](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223135020581.png)

发现差错之后，阻塞端口也有可能变成转发端口

### 源路由网桥

解决网桥冗余的另一种办法，通过发送方指定一条路径，必须经过的网桥，从而保证不会循环

![image-20231223135233293](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223135233293.png)

![image-20231223135621447](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223135621447.png)

## 交换机

![image-20231223140026956](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223140026956.png)

交换机中每个端口的网络都是一个冲突域，不同冲突域之间的站点可以进行全双工通信

集线器是共享介质（类似于一条总线上的），只能半双工

![image-20231223141841000](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223141841000.png)

![image-20231223142451857](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223142451857.png)

直通式的不会进行CRC的检错，而是从左到右读到DesinationMAC地址后，就直接转发了，没有存储和处理的时延

## 三层交换机和路由器

三层交换机具备传统的交换机的数据交换功能，但是他在硬件上实现的路由转发所以比基于软件的路由器效率更高，适合数据交换频繁的，三层交换机专注于提供高效的数据传输，但是路由器主要是支持不同复杂的网络协议和网络通信，适合不同网络类型的网络互联

 ![](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223150512525.png)

![image-20231223151234277](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223151234277.png)

## 主干网

![image-20240113222148816](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113222148816.png)

![image-20231223151819880](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223151819880.png)

![image-20231223152009412](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223152009412.png)

 

## 虚拟局域网

在交换机上使用软件来实现划分不同的广播域

![image-20231223152425118](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223152425118.png)

物理位置不靠近但是逻辑位置是划分在一个vlan里的

![image-20231223152725527](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223152725527.png)

虚拟的逻辑划分局域网，还可以减轻广播的站点数量，提高安全保密性

![image-20231223153241510](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223153241510.png)

基于交换机的端口划分VLAN

![image-20231223155914408](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223155914408.png)

基于协议的VLAN

![image-20231223160013850](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223160013850.png)

![image-20231223160034006](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223160034006.png)

![image-20231223160317612](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231223160317612.png)



通过逻辑上的建立连接，实现类似于处于同一个物理网段的效果而不需要改变物理位置，只需要改变vlan分组，就可以实现不同物理位置的通信，处于同一个vlan下的站点就可以互相通信，**划分了广播域**

![image-20240113223622023](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240113223622023.png)

# 第十九章.网络层

注意ip的数据报传递给数据链路层时，ip整个数据报包括头部20-60B也都是对于数据链路层帧的数据部分，如果是以太网，加上ip的头部总共数据部分不能超过1500B

![image-20240117145847034](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117145847034.png)

## IPV4

32bit

![image-20231224170840290](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224170840290.png)

## 分类的ip地址

每一个ip地址都是由网络号和主机号构成，网络号表明了主机或者路由器处于某个网络

![image-20231224201155709](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224201155709.png)

![image-20231224201314232](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224201314232.png)

几种分类的地址不断向下划分的时候，是不断减少一半

### A类地址

A类地址网络号是第一个字节，后三个字节是主机号

第一位为0，去掉了全0和0后面全1的

全0是表示本网络，0后面7个1表示是用于环回测试的，本主机进程通信使用

![image-20231224205426421](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224205426421.png)

主机号全0表示是网络地址（因为就只有网络地址非0了，主机地址都是0），本网络的地址（网络号不一定全0，这里就表示某个网络）

主机号全1表示该网络下的所有主机，是一个广播地址

### B类地址

前俩个字节表示网络号

第一个字节的前俩位固定了为 01

![image-20231224210427977](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224210427977.png)

### C类地址

前三个字节标识网络号

110

![image-20231224210650358](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224210650358.png)

在没有IP地址时，默认使用0.0.0.0，使用这个ip与DHCP服务器通信，获得分配的ip地址

![image-20231224211753276](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224211753276.png)

![image-20231224212252390](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224212252390.png)

![image-20231224212614617](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224212614617.png)

私有网络是内部的，没有置于因特网中，所以可以重复的，不受影响，路由器不会转发的

**D类地址用于多播**

![image-20240101211902960](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101211902960.png)

![image-20231224213313012](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224213313012.png)

![image-20231224213947584](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224213947584.png)

在一个网络的内部划分为几个子网，就是减少之前主机号的几位

 ==基于分类地址的子网划分，是将主机号的那部分进行划分一部分为子网号==![image-20231224214718074](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224214718074.png)

![image-20231224214823228](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224214823228.png)

![image-20231224214942400](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224214942400.png)

网络号没有改变，所以依旧可以通过网络号识别出是哪一类网络

**子网掩码**来找出IP地址中的子网部分

子网掩码与三级ip地址做与运算，会留下**子网的网络地址**

![image-20231224220117643](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224220117643.png)

 

默认的子网掩码可以把分类ip地址的网络地址取出

![image-20231224220335706](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224220335706.png)

自己的ip地址和子网掩码相与之后得到了自己，就是发送端所处于的网段，然后将目标的ip地址与子网掩码相与得到了对方的网段如果不是一个网段，就要成帧的时候MAC地址是默认网关，发往路由器的一个端口，否则就是一个网段内转发

## 无分类地址

之前的划分子网也是在分类ip的基础上，就是主机号中分了几位给子网号

![image-20231224224233997](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224224233997.png)

![image-20231224225628547](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224225628547.png) 

![image-20231224231951749](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224231951749.png)

地址划分很灵活

 

![image-20231224233037838](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224233037838.png)

![image-20231224233343113](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231224233343113.png)

前缀可以逐步确定子网

## 使用超网合并网段

取俩个网段的公共前缀部分作为网段，然后缩减公共前缀，使之合并为一个网段

![image-20231225123643783](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225123643783.png)



![image-20231225123604400](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225123604400.png)

![image-20231225123506456](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225123506456.png)

划分子网时，如果要求**连续**分配，就是分配的几个组之间的ip地址必须是连续的，不能有空的，因为是连续的，所以一定要从**低位向高**位算，这样可以保证连续



### 子网化（Subnetting）

- **定义**：子网化是将一个较大的网络划分成若干个较小的子网的过程。这是通过将原来属于主机部分的一些位借用作网络地址来实现的，从而增加了网络地址的位数，减少了每个子网中可用的主机数。
- **目的**：提高地址的使用效率，增加网络的安全性和管理的便捷性。

### 超网化（Supernetting）

- **定义**：超网化是将多个小网络合并为一个较大的网络的过程。这通常是通过减少网络地址中的位数来实现的，从而增加可用的主机数。
- **目的**：减少路由表的大小，简化路由过程。

### 在分类寻址中的子网掩码和超网掩码

- **分类寻址**：在IPv4的分类寻址中，每个类别（A、B、C）有一个默认的掩码（例如，A类地址的默认掩码是255.0.0.0）。
- **子网掩码**：在子网化中，子网掩码比默认掩码有更多的位设置为1，表示网络部分。例如，将一个C类地址（默认掩码255.255.255.0）细分为更小的子网，可能使用掩码如255.255.255.192。
- **超网掩码**：在超网化中，超网掩码比默认掩码有更少的位设置为1。例如，将几个C类地址合并为一个超网，可能使用掩码如255.255.254.0。

总结来说，子网化通过增加网络部分的位数来划分更小的网络，而超网化则通过减少网络部分的位数来合并多个小网络。在分类寻址中，子网掩码和超网掩码与默认掩码的主要区别在于它们的位设置，这直接影响了网络和主机部分的大小。

![image-20231225175822557](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225175822557.png)

==按顺序划分==的要注意后面分配的ip不能与前面的有交叉覆盖，就是要区分开每一组的ip地址

如果不仅要给组织分，这个组织下说了有多少个网络地址，就要从低位开始，可以**连续**的分配，下一次分配的起始地址就是上次的终止地址+1

![image-20231225131733814](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225131733814.png)

## NAT

将私有地址转换成公网的ip地址以便可以在互联网中通信，多个私有地址可以被映射成同一个公网ip

![image-20231225130814811](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225130814811.png)

# 第二十章.IP协议

host to host 

数据链路层是一跳到一跳

源端如果进行了分段，目的端就要重组

![image-20231225141846032](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225141846032.png)

路由选择，根据目标ip地址按照路由表进行路由选择，选择哪个端口

![image-20231225142028864](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225142028864.png)

网络层通信是无连接的，不需要保留状态，不需要建立和断开连接

网络层通信时数据报的**分组交换**,可能会存在失序，重复，丢失的问题，并不可靠，网络层就是尽力而为

## IPV4数据包格式

 ![image-20231225143152119](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225143152119.png)

![image-20231225143723063](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225143723063.png)

固定部分是20个字节，可选部分最大为40个字节，总共最多60个字节的首部

![image-20231225143838824](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225143838824.png)

首部长度是说header的长度，20-60个字节，首部一位相当于4个字节，最大是1111表示15*4B=60B



首部长度最小不是0，是5！所以如果小于5肯定出错了

![image-20231225150549006](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225150549006.png)

![image-20231225144009196](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225144009196.png)

服务类型，表示想要被提供的服务类型，比如什么最小时延，最大吞吐量，最小成本，最大可靠性

优先级![image-20231225144328053](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225144328053.png)

![image-20231225144443294](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225144443294.png)

![image-20231225144653390](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225144653390.png)

![image-20231225144836942](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225144836942.png)

以太网数据部分小于46字节要填充，大于1500字节要分段

标识部分是说明几个分段是属于同一个数据包的，同一分片，不是为了可靠服务的序号保证顺序

总长度的单位为1字节

![image-20231225145100543](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225145100543.png)

![image-20231225145210112](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225145210112.png)

片偏移是某个分组分片后的某一片的相对偏移量，**单位是8个字节**，是这一段的起始地址

生存时间TTL标识该数据报的生存时间，以前单位是时间，现在速度越来越快用时间不合适，这里变为了经过路由器的数量，经过一个路由器-1

TTL每次到一个路由器先-1，然后路由器判断这个数据报如果已经成负数了，就丢弃，然后发送ICMP差错报告控制报文超时给发送方

协议

![image-20231225150232511](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225150232511.png)

![image-20231225150242619](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225150242619.png)

首部校验和，不检查数据部分，只检查首部，不提供数据部分的差错控制



校验和是把每16个位bit也就是4个十六进制数作为一个单元去相加，然后如果最终到位首位有进位要回卷加到最后一位

[[中英字幕×精译搬运\] 错误检测与纠正1 网络校验和 Internet Checksum_哔哩哔哩_bilibili](https://www.bilibili.com/video/BV1dG4y1H7cp/?spm_id_from=333.337.search-card.all.click&vd_source=832575262c3ff10bdae72825b0c27407)

![image-20231225150329470](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225150329470.png)

## 分段

假设是以太网，就要满足1500字节的MTU的要求，如果过大就要进行分片（分段）

（二）IP分片的步骤：

       一个未分片的数据报的分片信息字段全为0，即多个分片标志位为0，并且片偏移量为0。分片一个数据报，需执行以下几个步骤：
 检查DF标志位，查明是否允许分片。如果设置了该位，则数据报将被丢弃，并将一个ICMP错误返回给源端。
 基于MTU值，把数据字段分成两个部分或者多个部分。除了最后的数据部分外，所有新建数据选项的长度必须为8个字节的倍数。
 每个数据部分被放入一个IP数据报。这些数据报的报文头略微修改了原来的报文头。
 除了最后的数据报分片外，所有分片都设置了多个分片标志位。
 每个分片中的片偏移量字段设为这个数据部分在原来数据报中所占的位置，这个位置相对于原来未分片数据报中的开头处。
 如果在原来的数据报中包括了选项，则选项类型字节的高位字节决定了这个信息是被复制到所有分片数据报，还是只复制到第一个数据报。
 设置新数据报的报文头字段及总长度字段。
 重新计算报文头部校验和字段。
       此时，这些分片数据报中的每个数据报如一个完整IP数据报一样被转发。IP独立地处理每个数据报分片。数据报分片能够通过不同的路由器到达目的。如果它们通过那些规定了更小的MTU网络，则还能够进一步对它们进行分片。
在目的主机上，数据被重新组合成原来的数据报。发送主机设置的标识符字段与数据报中的源IP地址和目的IP地址一起使用。分片过程不改变这个字段。
1、IP报文在传输过程中可能会多次分片

2、**IP报文分片再传输过程中只会越分越小，不会组装，组装统一在对端主机的IP层进行**

3、IP层不保证IP报文之间有序。但是对端主机在IP层会拼装IP报文分片，形成一个完整的IP报文后上传。拼装过程其实就是对IP报文分片进行收集、排序的过程。

![image-20231225151551276](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225151551276.png)

片偏移中一位的单位是8个字节，是每一片的起始位置

![image-20231225151709764](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225151709764.png)

![image-20231225152124270](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225152124270.png)

![image-20231225152441501](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225152441501.png)

![image-20231225153020110](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225153020110.png)

将一个分组分片是按照数据部分分片的，==协议的头部是额外每个分片都要加的==

可选项

![image-20231225153357302](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225153357302.png)

严格的源路由是在发送端就规定好了经过的路由器

![image-20231225153746088](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225153746088.png)

## IPV6

ipv6首部长度固定，可选项放到了载荷里payload，提高了路由器处理数据包的速度

![image-20231225154628309](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225154628309.png)

![image-20231225154732797](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225154732797.png)

![image-20231225154905447](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225154905447.png)

通信量类相当于ipv4中的服务类型，针对不同的需求

针对音视频的传输

![image-20231225155231582](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225155231582.png)

有效载荷长度不包括基本首部，但包含扩展首部也就是可选项

![image-20231225155354256](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225155354256.png)

如果不想要路由器转发，就是只在局域网内传播，就把跳数限制设置为1，

相同的流标号是处于相同的流，处于相同的服务，所以要经过相同的路由，提升路由器的处理速度 

![image-20231225160118213](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225160118213.png)

![image-20231225160236474](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225160236474.png)

下一个首部可以指向下一个扩展首部的首部，也可以是上层使用的协议

![image-20231225160333141](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225160333141.png)

ipv6将分段分到了扩展首部中，有需求才会去读关于分段的信息（在扩展首部中），否则就不会读，但ipv4由于分段的字段都在基本首部中，所以无论是否分段都会读取

![image-20231225160546593](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225160546593.png)

![image-20231225160602491](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225160602491.png)

### 扩展首部



![image-20231225161216681](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225161216681.png)

#### 源路由

将ipv4的严格源路由和松散源路由合并

#### 分片

ipv4是可以在发送端进行分片，然后路由器根据要发出的端口那一层网络协议的MTU再决定是否要再次分片，

ipv6是**只在源端进行分片**，使用了一种路径发现技术，可以发现路由路径中各个协议的MTU，然后根据最小的进行分片

## IPV4到IPV6的过渡

![image-20231225162136604](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225162136604.png)

### 双协议栈

![image-20231225162147657](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225162147657.png)

![image-20231225162204834](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225162204834.png)

### 隧道技术

在过渡初期使用，将ipv6整个数据包当成数据部分，然后封装成ipv4的数据包格式传输

![image-20231225162446812](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225162446812.png)

### 头部转换

针对ipv4和ipv6头部的不同进行转换

![image-20231225162840592](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231225162840592.png)

# 第二十一章.地址映射，差错报告和多播

## 地址映射

逻辑地址映射为物理地址

![image-20231226110310603](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226110310603.png)

静态映射是人手工的建立好逻辑地址与物理地址映射的表，但是不灵活，如果某个主机网卡坏了更换了MAC地址这个表就不准确了

ARP请求是广播发送，响应是单播

不同的局域网它的物理地址不同，长度都可能不同，所以在ARP的帧中会有什么类型的网络字段（还要指出MAC地址的长度，比如以太网就是6个byte），还要指出使用的网络层协议和使用的这个网络协议的ip地址的长度，单位是字节

各个主机收到广播信息也会建立更新自己的ARP表，将收到的源端IP地址和MAC地址建立映射，目标主机回复的ARP响应发送主机收到后，这是单播的，他也会更新自己的ARP表，下次直接发送即可，不需要使用ARP协议来计算

所以说ARP协议的前提是ARP表中没有这个IP地址对应的物理地址



![image-20231226112030003](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226112030003.png)

![image-20231226111421517](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226111421517.png)

ARP请求的封装帧，从网络层发给数据链路层包装，网络层给出的就是上方的协议，作为这一层的数据部分，相当于2.5层，在网络层但是没有使用IP协议进行数据报的封装

![image-20231226111932004](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226111932004.png)

![image-20231226112405414](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226112405414.png)

ARP是要广播的，所以被限制在一个广播域中，在传播过程中可能是一段一段的，经过多次ARP请求，看几个网段

![image-20231226113105079](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226113105079.png)



在发送方和目标主机位于不同网段的情况下，ARP请求仅用于在发送方所在的局域网内获取网关（路由器）的MAC地址。路由器负责处理跨网段的数据传输，必要时在目标网段内进行另一个ARP请求来获取目标设备的MAC地址。这样，ARP和路由器一起协作，确保数据能够从一个网段成功地传输到另一个网段

比方说假如接收方ip地址与发送方不处于一个网段，使用子网掩码得到网段，如果不相同，主机会先发送一个ARP请求，目标IP是默认网关的IP，然后得到路由器上这个网关的MAC地址，之后发送给路由器，路由器中如果也没有这个IP地址的ARP缓存，会到下一个网段，再去发送ARP请求，所以ARP请求的次数是跟网段次数有关系的



### 路由器间转发的过程

1. **IP层次的路由**：
   - 路由器在IP层次上工作。当一个路由器接收到一个数据包时，它查看该包的目标IP地址，并决定将其发送到哪个方向。
2. **路由表查找**：
   - 每个路由器维护一个路由表，包含了不同目的地的IP地址范围和对应的下一跳路由器的信息。路由器根据收到的数据包的目标IP地址，查找路由表以确定下一跳。
3. **使用下一跳地址**：
   - 一旦确定了下一跳，路由器就使用这个信息来转发数据包。如果下一跳是直接连接的网络，则使用ARP来确定下一跳设备的MAC地址。如果下一跳是另一个路由器，则该路由器已经在其接口上配置了下一跳路由器的IP地址，因此不需要ARP。
4. **WAN连接和不同的协议**：
   - 在广域网（WAN）或不同类型的网络连接中，可能使用不同的协议和方法来确定如何发送数据包。这些场景中不涉及ARP，因为它们不是基于MAC地址的局域网。
5. **链路层协议**：
   - 当数据包通过物理网络媒介（如以太网、光纤等）转发时，会使用相应的链路层协议。例如，在以太网中使用以太网帧，但这些操作对于路由器的IP层次转发过程是透明的。

### 总结

在路由器之间的转发过程中，ARP主要用于在直接连接的网络（如局域网）中解析目标设备的MAC地址。在更广泛的网络层次（如在不同网络或子网间的路由器转发）中，转发决策基于IP地址，并依赖于路由器的路由表，而不是基于ARP

### 代理ARP

不需要主机去回复ARP请求，由代理的ARP路由器回应，的路由器收到了一个ARP请求后，发现请求的IP地址对应到自己的一个端口的网段，就可以代替主机做出相应，他发出自己接收的MAC地址作为响应

![image-20231226113521544](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226113521544.png)

### ARP欺骗

对响应的单播的帧进行更改，将MAC地址改成自己别有用心的，让发送方给他发送数据

![image-20231226113820434](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226113820434.png)

![image-20231226114127570](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226114127570.png)

##### RARP

RARP主要用于无盘工作站在启动时根据其物理地址（MAC地址）获取IP地址。RARP通常涉及以下过程：

- 无盘工作站在网络上广播一个包含其MAC地址的RARP请求。
- RARP服务器接收到请求后，根据一个预先配置的映射表（将MAC地址映射到IP地址），找到相应的IP地址，并将其发送回请求的设备。

在RARP中，IP地址分配通常是静态的，因为它基于一个固定的、预先配置的MAC地址到IP地址的映射表。然而，这个过程也可以通过脚本或其他自动化手段来动态生成映射表，虽然这不是RARP最常见的用法。

RARP工作的方式是：网络设备在启动时广播一个包含其物理地址的RARP请求。网络上的RARP服务器收到这个请求后，查找相应的映射表，找到与物理地址对应的IP地址，然后将这个IP地址发送回请求设备。

RARP由于是广播形式的，所以每个局域网都需要一个RARP服务器，成本过高

#### BOOTP

BOOTP比RARP更灵活，它既可以支持静态地址分配，也可以支持动态地址分配：

- 在静态配置中，BOOTP服务器根据客户端的MAC地址，在预先配置的映射表中查找并分配固定的IP地址。
- 在动态配置中，BOOTP服务器可以从地址池中选择一个IP地址分配给客户端。这种情况下，虽然地址是动态分配的，但通常会为特定的MAC地址保留固定的IP地址。

出现了BOOTP协议，处于应用层的协议，使用UDP和IP协议，能够跨越不同的网段到服务器，服务器收到请求后，查询配置文件分配ip地址

他俩一般都是刚启动的时候，要请求一个ip地址，也包括子网掩码，默认网关等信息

![image-20231226115450695](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226115450695.png)

### 如何实现跨网段通信：

1. **广播限制**：
   - 广播消息在网络中是有限制的，它们通常不会被路由器转发到其他网络。这是因为广播消息如果不加限制地跨越网络，将导致严重的网络拥堵和安全问题。
2. **BOOTP中继代理**：
   - 要让BOOTP消息跨越网段，需要在网络中设置一个BOOTP中继代理。这个中继代理通常部署在网络的路由器上，或者是其他可以在两个或多个网络之间转发数据包的设备。
   - 当中继代理收到一个BOOTP请求（广播）时，它会将请求转发到指定的BOOTP服务器，即使这个服务器在不同的网络中。
   - 中继代理在转发请求时，会在BOOTP消息中添加一个“网关IP地址”字段，指明了请求的原始来源。这样，BOOTP服务器就能知道请求来自哪个网络，并据此分配适当的IP地址和其他网络信息。
3. **服务器响应**：
   - BOOTP服务器接收到通过中继代理转发的请求后，会根据请求中的信息决定如何响应。服务器通常会将响应直接发送给中继代理（而不是广播），然后中继代理再将响应发送回原始请求者。

![image-20231226115721528](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226115721528.png)

 

![image-20231226120024427](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226120024427.png) 

DHCP与BOOTP兼容，静态的地址配置是一个静态映射的数据库，还有一个动态的数据库，静态数据库比动态数据库优先级高

### DHCP中继代理的工作原理：

1. **DHCP广播**：
   - 当一个DHCP客户端启动并需要网络配置时，它会在本地网络上广播一个DHCP发现（DISCOVER）消息。由于广播消息通常不会被路由器转发到其他子网，因此如果DHCP服务器不在同一个局域网（LAN）上，它不会直接接收到这个消息。
2. **中继代理的作用**：
   - DHCP中继代理通常部署在连接不同子网的路由器上或者在其他能够在网络之间转发数据包的设备上。
   - 当中继代理收到DHCP发现消息时，它会将此消息转发到一个或多个配置的DHCP服务器上，即使这些服务器位于不同的网络。
3. **转发请求**：
   - 在转发请求时，中继代理会在DHCP消息中添加一个字段，指明了请求的原始子网。这样，DHCP服务器就能知道请求来自哪个子网，并据此分配适当的IP地址和其他配置信息。
4. **服务器响应**：
   - DHCP服务器收到请求后，会发送一个DHCP提供（OFFER）消息作为响应。这个响应被发送回中继代理，而不是直接广播。
   - 然后，中继代理将这个响应转发回原始的客户端。

通过这种方式，DHCP中继代理使得位于不同子网的设备能够从远程DHCP服务器获取所需的网络配置，而不需要在每个子网都部署一个DHCP服务器。这显著减少了网络管理的复杂性，并提高了网络配置的灵活性和可扩展性。

## ICMP（Internet Control Message Protocol）

ICMP（Internet Control Message Protocol）的设计主要是为了提供一种机制，用于在IP网络中传递控制消息。这些控制消息对于网络的诊断、错误报告和其他需要注意的情况至关重要。ICMP的设计目的包括以下几个方面：

1. **错误报告**：
   - ICMP允许网络设备报告错误情况。例如，当一个数据包无法达到其目的地时，ICMP可以用来通知发送方有关问题的信息。这对于故障诊断和解决网络问题是非常重要的。
2. **网络诊断和测试**：
   - ICMP支持工具如`ping`和`traceroute`，这些工具用于测试网络连接的质量（如延迟和丢包）以及确定数据包的路由路径。这对于网络的性能评估和故障排除非常有用。
3. **网络配置和管理**：
   - 在某些情况下，ICMP可用于辅助网络配置。例如，通过ICMP可以发现子网掩码或路由器的存在。
4. **通信的辅助反馈**：
   - ICMP为网络层通信提供了必要的反馈机制。例如，通过ICMP消息，发送方可以了解其数据包是否过大，需要分片等信息。
5. **简单性和效率**：
   - ICMP设计得相当简单，能够有效地执行其任务，而不会引入过多的复杂性或开销。

![image-20231226121450193](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226121450193.png)

ICMP就是来告诉发送方消息是否送达，以及是否出现错误（差错报告），主要是对于网络方便进行**诊断分析**

主机和路由器都可以进行报告，比如路由器因为堵塞把数据包丢弃，也要发消息告诉发送方

ICMP发送数据是要封装成IP数据包，使用IP协议，ARP是使用数据链路层成帧

![image-20231226122002285](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226122002285.png)

#### 差错报告报文类型

#### 差错报告消息

这类消息用于报告在处理IP数据包时发生的各种错误。重要的是要注意，为了避免产生无限循环，差错报告消息本身不会为其生成新的ICMP差错报告消息。下面是一些常见的ICMP差错报告类型：

1. **目的地不可达（Type 3）**：
   - 当数据包无法到达目的地时发送。它有不同的代码值来指明不可达的具体原因，如网络不可达、主机不可达、协议不可达、端口不可达等。
2. **源点抑制（Type 4）**：
   - 当路由器或目的地节点发现数据包的传输速率过快，无法及时处理时发送。这个消息提示发送方降低数据发送的速率。
3. **时间超过（Type 11）**：
   - 当数据包在网络中的存活时间（TTL）超过限制时发送。它通常表示路由环路或过长的传输路径。
4. **参数问题（Type 12）**：
   - 当数据包的IP头部有错误或者缺少必要信息时发送。
5. **改变路由（重定向）（Type 5）**：
   - 当路由器发现存在更好的路由到目的地时发送。它通知发送方后续的数据包应该使用新的路由。

![image-20231226122755901](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226122755901.png)

![image-20231226123526555](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226123526555.png)

![image-20231226123714253](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226123714253.png)

差错报告就是在接收到IP报文之后才可能去发的，由某个中途的接收方来发送

收到数据包后，将ip数据包的头部和数据包的前8字节（传输层的信息，这里是端口信息）保留下来，加上ICMP的头部然后封装成IP数据包发给源端

![image-20231226124051166](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226124051166.png)

![image-20231226124308378](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226124308378.png)

1. **网络不可达（Code 0）**：
   - 这意味着路由器无法找到到达目标地址所在网络的路由。在这种情况下，发送方可能需要检查目标IP地址是否正确，或者联系网络管理员。
2. **主机不可达（Code 1）**：
   - 指示虽然到达了目标网络，但无法将数据包传递给指定的终端设备（即目标主机）。这可能是因为主机不在线，或者路由器在目标网络中找不到该主机。
3. **协议不可达（Code 2）**：
   - 这种情况发生在目的主机无法识别数据包中指定的协议。例如，如果数据包中的协议字段不被目标系统识别或不支持，就会发生这种情况。
4. **端口不可达（Code 3）**：
   - 当数据包到达目标主机，但目标主机上没有应用程序正在监听目标端口时，就会发生端口不可达错误。这通常是因为目标服务没有运行或者被配置为使用其他端口。
5. **需要进行分片但设置了不分片位（Code 4）**：
   - 如果数据包的大小超过了下一个路由器或目标主机能够处理的最大传输单元（MTU），并且数据包的“不分片（DF）”标志被设置，路由器就会发送这个消息。这通常要求发送方减小数据包大小或允许分片





##### 源端抑制

补充的流量控制，当路由器或者接收方产生堵塞时，路由器或者主机会丢掉数据报，然后发送源端抑制

#### Time Exceeded超时

与IP协议的TTL有关系，路由器收到一个数据包会将他的TTL-1，如果超时了，会发送超时的错误报告

![image-20231226124633809](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226124633809.png)

 

ICMP还可以告诉发送方最佳的路由路径，就是路由器之间是可以通过协议来互通路由表的，但是主机一般是不参与这个过程的，因为主机量远大于路由器的量，主机是先发到默认网关也就是默认的路由器的端口，然后这个路由器可以查看自己路由表如果有更优的路由路径，会发送重定向信息给发送方，来更新主机的路由表，下次就通过其他的更佳路由器发送 

![image-20231226130108777](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226130108777.png)

![image-20231226125946027](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226125946027.png)

![image-20231226130224559](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226130224559.png)

#### 查询报文类型

**回显请求和回显应答（Echo Request and Echo Reply, Type 8 和 Type 0）**：

- 这是最常见的ICMP查询类型，通常用于实现“ping”操作。
- **用途**：用于检测目标主机是否可达（即它是否在线并且能够接收并响应数据包）。发送方发送一个回显请求消息，如果目标主机可达，它会回送一个回显应答消息。这个过程通常用于测试网络连接的质量，如丢包率和往返时间（RTT）。

![image-20231226130352473](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226130352473.png)

![image-20231226130424272](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226130424272.png)

1. **时间戳请求和时间戳应答（Timestamp Request and Timestamp Reply, Type 13 和 Type 14）**：
   - 这些消息用于记录发送和接收ICMP消息的时间。
   - **用途**：可以用来测量网络的往返延迟和进行时间同步。
2. **地址掩码请求和地址掩码应答（Address Mask Request and Address Mask Reply, Type 17 和 Type 18）**：
   - 这些消息用于请求和提供子网掩码信息。
   - **用途**：在某些没有其他手段获取子网掩码信息的网络环境中，这可以用来确定主机所在的子网。
3. **路由器请求和路由器通告（Router Solicitation and Router Advertisement, Type 10 和 Type 9）**：
   - 这些消息类型用于发现网络上的路由器及其地址。
   - **用途**：主要用于支持无盘或动态配置的网络环境，帮助主机在启动时发现可用的路由器。



##### echo request and reply

就是ping命令，它可以确定双方线路是否连通，就是是否可达，以及对方是否在线

![image-20231226131704854](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226131704854.png)

## IGMP 组管理协议





## ICMPV6

![image-20231226133711207](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226133711207.png)

多了一个分组过大的类型差错报告，用于实现MTU的探测功能，因为ipv6的分段是在源端实现的，所以需要知道路径中MTU的最小值，这里就是不断的接收到路由端发来的ICMP消息，如果是分组过大，就会调整为消息中说的MTU的分组大小，不断重复这个过程



![image-20231226133408256](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226133408256.png)

![image-20231226133448718](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226133448718.png)

![image-20231226133735989](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226133735989.png)

# 第二十二章.传递，转发和路由选择

路由器接入网络时，会自动识别每个接口配置的网络，从而加入路由表中，如果是这个路由器端口直接连接的网段，不需要经过下一跳或者更多跳的路由器，这种就是Direct直连，并且直连状态下的下一跳，如果要经过其他路由器，下一跳地址就是下一个路由器的某个端口ip，然后路由器根据这个ip通过某种算法得到要从哪个端口发出去

对于直连网络的话，路由表中的下一跳应该写发出去的那个端口的ip地址，**就是是自己的端口地址**



通过IP地址和子网掩码来判断是直接传递还是间接传递

 ![image-20231226153202324](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226153202324.png)

主机也有路由表，在ICMP的Redirection重定向报文，可以给主机的路由表增加路由项

 路由器的路由表关注于**下一跳**，而不是所有的路由信息，就是不需要记录完整的路径，只需要next

![image-20231226162452181](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226162452181.png)

不是每个主机对应一个表项，而是针对每个网络（==网络地址==，而不是具体的某一个主机的ip地址），==特定网络方法==

![image-20231226162736649](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226162736649.png)

 

默认方法是路由表项种特定的网络如果都不符合就走默认的路由

![image-20231226163026383](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226163026383.png)

![image-20231226163204338](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226163204338.png)

使用掩码来计算网络地址

## 最长掩码匹配

掩码越长，标识网络地址越长，划分的越细致，当一个数据包的ip地址可能匹配到多个路由记录，这里肯定用更长的掩码获取到更细致的信息，从而确定到他属于的网络

### 为什么使用最长前缀匹配

- **精确性**：较长的前缀提供了更精确的目的地匹配，因为它们描述了更具体的目标网络。
- **灵活性**：这允许网络管理员设计更复杂的网络拓扑，例如使用不同的子网划分和更细粒度的路由控制。
- **效率**：通过选择最精确的路由，网络流量可以被更有效地导向目的地，减少了不必要的跳数和潜在的网络拥塞。

### 处理多条匹配路由

- 如果路由表中有多条路由具有相同长度的最长前缀匹配，则路由器可能会根据其配置进行负载均衡，将流量分配到这些路由中。
- 在某些情况下，更具体的路由规则（如策略路由）可能会覆盖最长前缀匹配规则。

下面的这个情况是如果走到了大学还是可以走到四系，但有的就不行了

![image-20231226165512501](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226165512501.png)



如果这个分组走了m0就不行了

![image-20231226165851288](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226165851288.png)





![image-20231226171252778](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226171252778.png)

直连路由就是与路由器的端口直接相连的那个网段的信息会被记录到路由表中

##### 下一跳该怎么填的很好诠释

![image-20231226171900705](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226171900705.png)

![image-20231226172500094](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226172500094.png)

OSPF路由协议的优先级比RIP协议更高

#### 超网化

一般就是路由表中很多表项都是通过同一个端口出去的话，就是下一跳相同的话，可以进行公共前缀的提取



提取公共前缀组成超网，可以减少路由表中的表项

![image-20231226182313472](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226182313472.png)

![image-20231226182425048](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226182425048.png)

路由器端口直接相连的几个网段是可以通过直连的方式被路由器识别然后填入表项的



![image-20231226183109194](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226183109194.png)



![image-20231226183059508](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231226183059508.png)

### 路由算法

评价的标准就是按照最小跳数或者最小的代价（成本）

![image-20231227133137780](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227133137780.png)

![image-20231227135544779](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227135544779.png)

![image-20231227140955091](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227140955091.png)

Bellman-Ford算法是把所有的边标序号，然后每次循环遍历所有边，看从这个节点经过这条边后，是否加起来的数比他记录的更小，实际就是rip的思想，与邻居互相交换路由表的信息，来更新最短距离



## 单播路由选择协议

![image-20231227141815072](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227141815072.png)

有以代价为度量的，也有以可达性为度量的

 域内自治系统就是划分了几个区域，一般区域内使用RIP或者OSPF协议，区域之间使用可达性协议BGP

==intradomain是域内，interdomain是域间==

![image-20231227142409965](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227142409965.png)

### RIP

距离向量

![image-20231227143050404](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227143050404.png)

路由器之间互相交换路由表

![image-20231227143136741](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227143136741.png)

C发给A时，要更新一下路由表，加上C到A的代价，然后将下一跳改成自己

==下一跳如果都一样选择新的不考虑代价==，因为可能old旧的有故障了，新的绝对是没问题的

![image-20231227143733652](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227143733652.png)

![image-20231227144015315](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227144015315.png)  

![image-20231227151738934](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227151738934.png)

![image-20231227152432724](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227152432724.png)

![image-20231227152932039](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227152932039.png)

路由表中目的地，达到这个目的地的最小的总距离，以及如果想走最小的就要下一跳去哪里

RIP容易出现**路由环路**的问题，比方说一个链路出现了问题，与其直接连接的路由器获得了信息，更新了路由表，但是并没有立即的将信息更新发送到与其相连的其他路由器，此时假设R2发来交换路由表的信息，发现到这个已经损坏的X，并且下一跳是来自这个R2，R1一看同样都是到X，我这里都断开了，是无穷大，通过你我反而可以到达X，于是R1更新路由表，下一跳是R2，此时就陷入了一个环路的问题。

下一个时间段，R1给R2传递路由表信息的时候，由于下一跳改为了R1，R2此时是看到相同的都要到X，而且下一跳是相同的，就会不看代价直接更新，于是双方就陷入了重复的循环。

一些措施：

1.设置跳数的上限

2.分割范围：当一个路由器是从另一个路由器那里学到的最佳路径时，我发送路由表信息的时候不会带上这条记录

3.毒性逆转：也是类似的，这里是会欺骗我学到的那个路由器，告诉他距离是无穷大。当路由器通过一个邻居学习到一个目的地的路由信息时，它会在向该邻居发送路由更新时，将这个目的地的度量值设置为“无穷大”（在RIP中通常是16），即告诉邻居这个目的地是不可达的。

![image-20231227222245954](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227222245954.png)

![image-20231227220902949](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227220902949.png)

RIP也是只和相邻的路由器交换信息，然后依次的互相交流自己的路由表信息从而影响到整个自治区域

![image-20240114175002310](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240114175002310.png)

![image-20240114175145997](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240114175145997.png)



### RIP的优缺点



### 1. 缺点：跳数限制

- **描述**：RIP使用跳数作为路由选择的度量标准，其最大跳数限制通常设置为15跳。这导致RIP不适用于大型网络。
- **补救方法**：对于大型网络，应考虑使用其他路由协议，如OSPF或BGP，这些协议没有严格的跳数限制，可以更好地处理大型网络。

### 2. 缺点：慢速收敛

- **描述**：RIP使用定期更新来交换路由信息，这可能导致网络状态变化后路由收敛较慢。
- **补救方法**：可以使用触发更新（Triggered Updates）机制，当路由信息发生变化时立即发送更新，而不是等待下一个周期性更新。

### 3. 缺点：计数到无穷问题

- **描述**：RIP容易受到“计数到无穷大”问题的影响，这是因为错误的路由信息可能在网络中不断传递和增加。
- **补救方法**：引入路由毒化（Route Poisoning）和毒性逆转（Poison Reverse）机制，通过显式地将失效路由的度量值设置为无穷大来减少错误信息的传播。

### 4. 缺点：只基于跳数的路由选择

- **描述**：RIP仅根据跳数来选择路由，没有考虑链路的带宽、延迟或其他重要因素。
- **补救方法**：在需要考虑链路质量的场合，使用更先进的路由协议，如OSPF或EIGRP，它们可以根据多种因素来选择最佳路径。

### 5. 缺点：无法支持不同网络类型的复杂拓扑

- **描述**：RIP较为简单，不支持高级路由技术，如VLSM（可变长子网掩码）或CIDR（无类别域间路由）。
- **补救方法**：采用更现代的协议如RIPng（RIP的下一代版本，支持IPv6）或其他协议如OSPF、BGP等。

### 6. 缺点：带宽利用不高效

- **描述**：由于RIP使用固定的更新间隔，可能导致不必要的带宽消耗。
- **补救方法**：限制更新频率或使用触发更新来减少不必要的网络流量。

![image-20231227222940729](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227222940729.png)

![image-20231227221010750](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227221010750.png)

#### RIP使用UDP分组发送

### 链路状态路由选择 OSPF

洪泛链路状态信息，路由器的各个接口发出去，不包括收到分组的接口

![image-20231227212601946](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227212601946.png)

将一个自治系统进一步划分区域，减小洪泛的范围![image-20231227214402966](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231227214402966.png)

链路状态就是这个路由器与其邻居路由器之间的成本考量，和邻居节点都有哪些（所以一个路由器启动后，会先探测周围的邻居，确认邻居关系）

当各个路由器之间频繁的互通链路状态信息后，会生成一个统一的链路状态数据库，就是全网的拓扑结构，每个节点都会有

当洪泛完成之后，每个节点都有全网的拓扑图此时在使用迪杰斯特拉算法计算出最小生成树获得最短路径

![image-20231228120559557](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231228120559557.png)

1. **点对点链路（Point-to-Point）**
   - **分类基础**：这种类型的链路直接连接两个路由器，没有其他中间设备。
   - **用途**：常见于广域网（WAN）连接，如两个路由器之间的串行链路。
2. **过渡链路（Transit）**
   - **分类基础**：过渡链路连接多个路由器，是数据通过的路径。
   - **用途**：主要用于多访问网络，如以太网，其中路由器需要选举一个指定路由器（Designated Router, DR）。
3. **Stub链路（Stub）**
   - **分类基础**：Stub链路连接到一个局域网（LAN），该LAN没有其他连接到OSPF网络的路由。
   - **用途**：这些链路上的路由器通常只有一个出口到OSPF网络。

​	stub链路是这个链路属于末尾，只连接一个局域网网络。stub链路通常是网络的边界，只连接到一个特定的网络或子网，而过渡链路则像是网络的桥梁，连接不同的网络并传输数据





1. **虚链路（Virtual Link）**
   - **分类基础**：虚链路不是物理链路，而是通过其他区域创建的逻辑连接。
   - **用途**：虚链路主要用于连接分隔的OSPF区域到主干区域（Area 0），特别是在无法直接连接到主干区域的情况下。

OSPF（Open Shortest Path First）报文通常被认为比RIP（Routing Information Protocol）报文更快，主要原因在于它们各自的设计哲学和工作机制。以下是一些关键点，解释了为什么OSPF通常比RIP更快、更有效：

1. **更新机制**：
   - **RIP**：使用定时更新机制，无论网络状态如何，每隔30秒发送完整的路由表。这种方法可能导致响应网络变化较慢。
   - **OSPF**：使用即时更新和洪泛机制，当**网络状态发生变化**时，立即发送增量更新（只包含改变的信息）。这使得OSPF能够更快响应网络变化。
2. **路由计算算法**：
   - **RIP**：基于距离矢量算法，更新需要在网络中逐跳传播，可能导致较慢的收敛时间。使用Bellman-Ford算法
   - **OSPF**：使用Dijkstra的最短路径优先算法（SPF），直接计算最短路径。每个路由器独立完成计算，使得整个网络能更快地收敛。
3. **网络变化的响应**：
   - **RIP**：对于网络的变化反应较慢，由于定时更新，可能需要几分钟才能完全传播新的路由信息。
   - **OSPF**：能够迅速反应网络变化，因为它通过洪泛机制快速传播链路状态的变化。
4. **链路状态信息**：
   - **RIP**：不存储详细的链路状态信息，只有跳数信息。
   - **OSPF**：维护详细的链路状态数据库，包含网络的完整拓扑，使得路由决策更加准确和高效。
5. **负载均衡和多路径**：
   - **RIP**：仅支持基于跳数的简单负载均衡，不支持复杂的多路径路由。
   - **OSPF**：支持多路径路由和更复杂的负载均衡策略。
6. **可扩展性和区域划分**：
   - **RIP**：缺乏有效的区域划分，不适合大型网络。
   - **OSPF**：支持区域（Area）划分，提高了大型网络的管理效率和性能。

总之，OSPF在设计上更适合大型和动态变化的网络环境，它的响应速度和灵活性比RIP高得多。这些特性使得OSPF在现代网络环境中更受青睐。



## 路径向量路由选择协议

自治系统之间的路由选择

![image-20231228120902556](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231228120902556.png)

每个自治系统中有一个代表，然后这个代表初始的表是自己区域内的一些信息

![image-20231228121109457](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231228121109457.png)

![image-20231228121222338](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231228121222338.png)

# 第二十三章.UDP，TCP和SCTP

网络层是尽最大努力交付，不够可靠，传输层来提供差错控制，流量控制，是端到端的，数据链路层是一跳到一跳的

![image-20231229144119170](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229144119170.png)

网络层只管传输，不区分这几个分组是哪个应用进程的，传输层要区分

端口号16位

![image-20231229144457312](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229144457312.png)

多个进程同时使用同一个传输层的协议，比如TCP，这就是复用

分离就是接收方根据不同的端口号区分

![image-20231229144812339](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229144812339.png)

![image-20231229144830960](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229144830960.png)

传输层进一步提供差错控制是防止每个节点中数据链路层和网络层之间的交付出现问题

![image-20231229145032081](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229145032081.png)

![image-20231229145509278](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229145509278.png)

需要进行交互多次的适合事先建立好连接，还有进行分段传输的适合用TCP

![image-20231229145627416](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229145627416.png)

## 用户数据报UDP

![image-20231229145958210](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229145958210.png)

UDP协议头部源端口号，目的端口号，总长度，校验和

总长度也可以通过IP层协议的总长度减去首部长度得到，这里添加上可能是为了字节填充



![image-20231229150419720](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229150419720.png)

UDP校验和的计算要包括**伪首部**，因为要保证源IP和目标IP地址不能出现问题，以及传输的类型总长度

1. **伪首部**：首先，构造一个伪首部，它包括源IP地址、目的IP地址、保留字节（通常设为0）、协议类型（对于UDP是17）和UDP数据报的长度（包括UDP头部和数据）。
2. **UDP头部和数据**：然后，将整个UDP数据报（包括头部和数据）添加到伪首部后面。
3. **校验和计算**：在这个组合的数据集（伪首部 + UDP数据报）上进行校验和的计算。这个计算是通过将数据划分为16位的一组，然后对这些16位的数进行二进制求和，如果有进位，则将进位加回到结果的最低位，最后对得到的总和取反。

UDP面向报文，不会对报文进行分段和结合

![image-20231229151500981](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229151500981.png)

UDP只有一点点的差错控制就是在头部的校验和，使用UDP的应用最好有自己的差错检控

适合实时的应用，低延迟

首部只有八个字节，8 bytes

![image-20231229151815877](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229151815877.png)

1. **接收缓冲区**：在接收端，操作系统通常会为UDP套接字维护一个接收缓冲区。当网络数据包到达时，它们会被放入这个缓冲区中。应用程序需要定期从缓冲区中读取这些数据，以避免缓冲区溢出导致的数据丢失。这个缓冲区实际上可以看作是一种队列，数据按照到达的顺序排列。
2. **发送缓冲区**：尽管UDP不保证数据的送达，但在发送端，操作系统也可能会维护一个发送缓冲区。这个缓冲区用于暂存应用程序传递给UDP套接字的数据，直到操作系统处理完毕并将其发送到网络上。这个缓冲区也类似于一个队列。

## TCP

面向连接的，可靠的

FTP数据端常用端口号为20，控制端为21

![image-20231229152138084](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229152138084.png)

面向字节流，像是建立好一个管道

![image-20231229152312138](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229152312138.png)

![image-20231229152447120](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229152447120.png)

分段segment就是会选取**若干个字节**加上首部传给下一层网络层

![image-20231229152659671](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229152659671.png)

### 序号系统

一次连接的开始的字节起始的编号是一个随机数

每个字节都会有序号和确认号，而不是对每一个段进行编号，段的编号是段中第一个字节的编号![image-20231229162718646](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229162718646.png)

![image-20231229162855201](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229162855201.png)

### TCP首部

也是有固定的长度，20个字节，以及可选项，最长也是40byte

20~60字节

![image-20231229163113850](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229163113850.png)

确认号字段是接收方期待收到的**下一个字节**的编号

TCP的校验和也要加上伪首部

![image-20231229163917300](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229163917300.png)

### MSS（最大报文段长度）

- **定义**：MSS是TCP协议中的一个概念，指的是TCP层可以接受的每个报文段（segment）的最大数据长度，不包括TCP头部。
- **用途**：MSS主要用于控制TCP报文段的最大数据量，从而减少分段的需求，提高网络效率。
- **确定方式**：MSS通常在TCP三次握手过程中通过选项字段确定。它是基于MTU值减去固定的IP和TCP头部长度来计算的。
- **举例**：如果MTU是1500字节（常见的以太网MTU），TCP头部和IP头部通常各占20字节，因此MSS通常是1460字节（1500 - 40）。

### MTU（最大传输单元）

- **定义**：MTU是指在一个特定的物理网络层（如以太网）上可传输的最大数据包大小，包括了所有的网络层（如IP层）和数据链路层的头部。
- **用途**：MTU用于确保数据包在物理网络上传输时不会被分片。如果一个数据包超过了网络的MTU，那么它需要在发送之前进行分片（在IP层处理）。
- **确定方式**：MTU的大小由具体的物理网络环境决定，不同的网络类型有不同的MTU值。例如，以太网的标准MTU通常是1500字节。
- **影响**：MTU的大小影响着上层协议（如TCP）设置MSS的值，确保TCP报文段在网络中传输时不需要分片。

### 区别

- **层级不同**：MSS是TCP层的概念，而MTU是网络层和数据链路层的概念。
- **含义不同**：MSS关注的是TCP报文段的数据部分的大小，而MTU关注的是整个IP数据包的大小，包括所有头部。
- **目的不同**：MSS的目的是优化TCP性能，减少分段，而MTU的目的是适配物理网络的限制，避免分片。

### 控制字段

#### 紧急指针 urgent pointer

需要把这段数据放在段的开始，接收方不会按顺序来取，会优先利用紧急指针的值取出紧急数据

![image-20231229164654746](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229164654746.png)

紧急指针字段的值是一个偏移值，指的是对于这个TCP的分段的起始位置，偏移了多少，确定了紧急数据的一个范围

例如，如果一个TCP段的序列号是1000，且紧急指针字段的值是10，那么这表示紧急数据从序列号1000开始，到序列号1009（包括1009）的位置结束。换句话说，紧急数据占据了这个TCP段中从第一个字节到第十个字节的区域。

![image-20231229165541973](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229165541973.png)

![image-20231229165810546](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229165810546.png)

![image-20231229170416412](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229170416412.png)

## 连接

### 俩次握手存在的问题

容易出现和上一次连接重叠的问题，就是连接没有建立好

就是上次连接的一些信息由于某种原因延迟到达了，影响到了这次连接，比如上次的一个分段正好和我这次要发的重叠了，就会错误的接收上次的信息。

还有就是上次的连接SYN迟到了，影响了这次同步的发送，开了一个新连接，但却是上次的连接

![image-20231229171122161](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229171122161.png)

### 三次握手

单纯的一个ACK的段（不携带数据）不会占据编号

ACK报文如果携带了数据，那么序号就是8001

![image-20231229183132238](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229183132238.png)

![image-20231229171821211](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229171821211.png)

### 请求连接

SYN请求时，只会占用一个序号，会选择一个序号x带过去，作为发送方的初始序号

![image-20231229182253766](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229182253766.png)

![image-20231229175953612](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229175953612.png)

### 确认连接

为什么接收方也要发送SYN，因为SYN表示请求建立连接，这是互相的，所以接收方也发送SYN并且响应发送方的上次请求ACK

ack序列号是上个报文的序列号+已经成功收到数据长度，比如上次成功接收了seq为1，长度为1000的数据，发送的ack序号为1001，表示我seq1000以前的数据我已经成功接收了，我对序列号1001开始的数据感兴趣。

SYN+ACK确认时，也只会占用一个序号，这里是接收方要发给发送方数据的起始字节序号seq，同时也携带着对请求连接的确认ack然后期望是下一个x+1

![image-20231229182344225](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229182344225.png)

![image-20231229180051073](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229180051073.png)

![image-20231229180154462](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229180154462.png)

![image-20231229180705713](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229180705713.png)



### 确认的确认

这个ACK如果不携带数据的话，是不会消耗掉字节的序列号seq的

当==syn 或 fin被置1==，虽然报文里长度为0，计算ACK时我们可以认为其长度为1。其他情况（如只有ack）不增加。

只发送ACK但是不携带数据的分段不会消耗掉序号，只是名义上写着序号

![image-20231229183658204](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229183658204.png)



![在这里插入图片描述](https://img-blog.csdnimg.cn/20190313092433879.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MjMwNjQ0MA==,size_16,color_FFFFFF,t_70)

![image-20231229184836416](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229184836416.png)

序列号反应了当前方发送数据的多少，多少个字节

## 数据传输

![image-20231229181156890](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229181156890.png)

## 四次握手的关闭

因为接收方还没有发送完数据，所以要四次

![image-20231229181552621](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20231229181552621.png)

## 流量控制

 TCP的窗口是可变大小的，根据接收方发来的窗口大小和拥塞控制的窗口大小来选择最小值

![image-20240101165408668](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101165408668.png)

![image-20240101165800719](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101165800719.png)

当接收方告知发送方0窗口时，发送方会有一个计时器，当过了这个时间之后发送探测报文（1个字节）来询问接收方现在的接收窗口大小

![image-20240101170122815](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101170122815.png)

不要空出一个字节就发送，传输 效率很低

![image-20240101170558089](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101170558089.png)

## 差错控制

占用序号的控制字段也需要确认，ACK不需要确认



![image-20240101171026356](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101171026356.png)

![image-20240101171853683](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101171853683.png)

 

收到三个重复的相同序号ACK，就快速重发，不需要等待超时



![image-20240101172720191](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101172720191.png)

 

丢失了，这里也是等计时器超时了就重发，不是ACK来了立马就重传

![image-20240101173053926](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101173053926.png)

![image-20240101173409910](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101173409910.png) 

## 拥塞控制

拥塞控制的前提是网络能够承受，是全局性的 

![image-20240101184649052](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101184649052.png)

 

### 慢启动---指数增加

![image-20240101201430307](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101201430307.png)

起始窗口的大小是MSS，**最大报文段的长度**

刚开始只发一个报文，后来以2的倍数指数级增加拥塞窗口的大小，会逐渐达到一个阈值

![image-20240101190338040](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101190338040.png) 

![image-20240101190505421](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101190505421.png)

![image-20240101190723806](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101190723806.png)

拥塞避免是加性增加，一次增加一个窗口的大小

拥塞检测要看拥塞的程度，轻度拥塞和重度拥塞

重度拥塞反映强烈，窗口变为1，从慢启动阶段开始

轻度拥塞窗口变为阈值，从拥塞避免开始

![image-20240101191219057](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101191219057.png)

![image-20240101191821204](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101191821204.png)

![image-20240101193230347](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101193230347.png)  

![image-20240101202509403](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101202509403.png) 

![image-20240101203818643](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101203818643.png)

![image-20240101204551158](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101204551158.png)



![image-20240101205709172](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101205709172.png)

![image-20240101205729702](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240101205729702.png)

# 做题

CSMA/CD的最短冲突检测时间，就是一个传播时间，说明俩者同时开始发，最长的冲突检测时间就是求最小帧长的情况，当一个数据位马上到了的时候他在开始发，俩倍传播时间

当在拥塞控制时，如果发生了超时或者连续收到3个ACK，**阈值会变为当前的一半！**，当慢启动到这个阈值后会到加性增加阶段。

假设是慢启动阶段，0时刻拥塞窗口就是1，经过一个RTT，也就是到了1时刻之后，就是2的一次方，拥塞窗口就是2了，这里注意0-1这个第一个RTT的时间内，发送的是大小为1个MSS，收到确认成功后在一时刻这个窗口才变成2，所以我前面说的每个时刻的窗口大小是成功收到了这个时刻前的一个RTT内发送的数据的ACK后的大小

![image-20240114214938876](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240114214938876.png)

当在慢启动阶段，如果阈值为6，4之后就不能是8了，直接就是阈值，不能超过阈值

记住从0时刻开始就行，0时刻从慢启动开始就是一个MSS的长度，经过一个RTT就是下一个时刻了

# DNS

![image-20240117160950638](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117160950638.png)

![image-20240117161520942](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117161520942.png)

![image-20240117161939958](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117161939958.png)

DNS使用UDP，端口号为53

## DNS报文

![image-20240117163831596](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117163831596.png)

![image-20240117163627365](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117163627365.png)

授权部分里有权威服务器的信息

![image-20240117164252627](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117164252627.png)

![image-20240117164324187](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117164324187.png)

![image-20240117164445768](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117164445768.png)

# SMTP

传送ASCII码文本数据

​    

![image-20240117170615089](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117170615089.png)    

![image-20240117170806636](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117170806636.png)

# POP和IMAP

![image-20240117171135832](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117171135832.png)

![image-20240117171643824](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117171643824.png)

# HTTP

![image-20240117173317110](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117173317110.png)

![image-20240117173842060](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117173842060.png)

## Cookie

![image-20240117174252017](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117174252017.png)

![image-20240117184427455](C:\Users\papa\AppData\Roaming\Typora\typora-user-images\image-20240117184427455.png)
